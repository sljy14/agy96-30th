<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Map view</title>

<style>
  html,body{
    margin:0;height:100%;
    background:
      radial-gradient(900px 520px at 50% 25%, rgba(120,255,235,0.14), transparent 62%),
      radial-gradient(900px 520px at 50% 75%, rgba(160,120,255,0.12), transparent 62%),
      linear-gradient(160deg,#06202a,#070714);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
    color:#fff;
  }

  .wrap{
    height:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    padding:18px 16px 14px;
    box-sizing:border-box;
  }

  h1{
    margin:6px 0 6px;
    font-weight:1000;
    letter-spacing:-0.5px;
    font-size:28px;
    text-align:center;
  }
  .sub{
    margin:0 0 10px;
    opacity:0.86;
    text-align:center;
    font-size:14px;
  }

  .qWrap{
    width:min(420px, 94vw);
    border:1px solid rgba(255,255,255,0.14);
    background:rgba(255,255,255,0.06);
    border-radius:18px;
    padding:12px 14px;
    box-sizing:border-box;
    margin-bottom:12px;
    text-align:center;
  }
  .qTitle{
    font-weight:1000;
    margin:0 0 6px;
    font-size:14px;
    opacity:0.95;
  }
  .qText{
    margin:0;
    font-size:15px;
    font-weight:850;
    letter-spacing:0.2px;
  }
  .tryAgain{
    margin-top:8px;
    font-weight:900;
    color:#ffd6d6;
    display:none;
  }
  .tryAgain.show{ display:block; }

  .mapCard{
    width:min(420px, 94vw);
    border:1px solid rgba(255,255,255,0.14);
    background:rgba(255,255,255,0.06);
    border-radius:18px;
    padding:12px;
    box-sizing:border-box;
  }

  .stage{
    position:relative;
    width:100%;
    aspect-ratio: 1 / 1;
    border-radius:14px;
    overflow:hidden;
    border:1px solid rgba(255,255,255,0.10);

    /* light green "town map" vibe */
    background:
      radial-gradient(2px 2px at 20% 30%, rgba(0,0,0,0.10) 40%, transparent 41%) ,
      radial-gradient(2px 2px at 65% 70%, rgba(0,0,0,0.10) 40%, transparent 41%) ,
      radial-gradient(2px 2px at 50% 50%, rgba(0,0,0,0.08) 40%, transparent 41%) ,
      linear-gradient(180deg, rgba(255,255,255,0.08), rgba(0,0,0,0.10)),
      linear-gradient(180deg, #bfe9c8, #a9dbb4);
    background-size: 80px 80px, 90px 90px, 110px 110px, 100% 100%, 100% 100%;
  }

  .spot{
    position:absolute;
    width:120px;
    height:120px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:14px;
    background:rgba(255,255,255,0.10);
    border:1px solid rgba(0,0,0,0.10);
    box-shadow: 0 10px 30px rgba(0,0,0,0.18);
    cursor:pointer;
    user-select:none;
    -webkit-tap-highlight-color: transparent;
  }
  .spot:active{ transform:scale(0.98); }

  .label{
    position:absolute;
    top:-28px;
    left:50%;
    transform:translateX(-50%);
    font-weight:1000;
    font-size:12px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.16);
    background:rgba(0,0,0,0.28);
    color:#fff;
    white-space:nowrap;
    pointer-events:none;
  }

  canvas.icon{
    width:92px;
    height:92px;
    image-rendering:pixelated;
  }

  /* positions (random-ish like you said) */
  #stadiumSpot{ left:18px; top:18px; }
  #waterlooSpot{ right:18px; top:18px; }
  #chinatownSpot{ left:18px; bottom:18px; }
  #macritchieSpot{ right:18px; bottom:18px; }

  /* center avatar */
  .center{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width:120px;
    height:160px;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
  }
  .agyTag{
    position:absolute;
    top:-26px;
    left:50%;
    transform:translateX(-50%);
    font-weight:1000;
    font-size:12px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.16);
    background:rgba(0,0,0,0.28);
  }

  /* Mini agy96 (same visual language as your main page) */
  .pixel{ width:100px; height:140px; position:relative; }
  .hair{
    position:absolute; width:72px; height:98px; background:#000;
    top:0; left:50%; transform:translateX(-50%); border-radius:10px;
  }
  .face{
    position:absolute; width:48px; height:54px; background:#f1c7a6;
    top:26px; left:50%; transform:translateX(-50%); border-radius:2px;
  }
  .glasses{
    position:absolute; top:46px; left:50%; transform:translateX(-50%);
    display:flex; align-items:center;
  }
  .glasses .side{ width:10px; height:4px; background:#000; }
  .glasses .lens{ width:18px; height:14px; border:3px solid #000; box-sizing:border-box; }
  .glasses .bridge{ width:8px; height:4px; background:#000; }

  .body{
    position:absolute; top:86px; left:50%; transform:translateX(-50%);
    width:62px; height:40px; background:#c1272d;
  }
  .pants{
    position:absolute; top:124px; left:50%; transform:translateX(-50%);
    width:64px; height:24px; background:#0e0e18;
  }
  .shoes{
    position:absolute; top:148px; left:50%; transform:translateX(-50%);
    width:58px; height:10px; background:#fff;
  }

  /* jump animation */
  @keyframes hop {
    0%{ transform:translate(-50%,-50%) translateY(0); }
    25%{ transform:translate(-50%,-50%) translateY(-10px); }
    50%{ transform:translate(-50%,-50%) translateY(0); }
    75%{ transform:translate(-50%,-50%) translateY(-10px); }
    100%{ transform:translate(-50%,-50%) translateY(0); }
  }
  .jumpTwice{
    animation: hop 420ms ease-in-out 1;
  }

  @media (max-width: 380px){
    .spot{ width:110px; height:110px; }
    canvas.icon{ width:84px; height:84px; }
  }
</style>
</head>

<body>
<div class="wrap">
  <h1>Map view üó∫Ô∏è</h1>
  <div class="sub">Tap on the right place!</div>

  <div class="qWrap">
    <div class="qTitle">Question</div>
    <p class="qText" id="questionText">Where will you get some shiok and numbing food?</p>
    <div class="tryAgain" id="tryAgain">Try again!</div>
  </div>

  <div class="mapCard">
    <div class="stage" id="stage">
      <!-- Stadium -->
      <div class="spot" id="stadiumSpot" data-place="stadium" role="button" aria-label="Stadium">
        <div class="label">Stadium</div>
        <canvas class="icon" id="stadiumIcon" width="96" height="96"></canvas>
      </div>

      <!-- Waterloo -->
      <div class="spot" id="waterlooSpot" data-place="waterloo" role="button" aria-label="Waterloo">
        <div class="label">Waterloo</div>
        <canvas class="icon" id="waterlooIcon" width="96" height="96"></canvas>
      </div>

      <!-- Chinatown -->
      <div class="spot" id="chinatownSpot" data-place="chinatown" role="button" aria-label="Chinatown">
        <div class="label">Chinatown</div>
        <canvas class="icon" id="chinatownIcon" width="96" height="96"></canvas>
      </div>

      <!-- MacRitchie -->
      <div class="spot" id="macritchieSpot" data-place="macritchie" role="button" aria-label="MacRitchie">
        <div class="label">MacRitchie</div>
        <canvas class="icon" id="macritchieIcon" width="96" height="96"></canvas>
      </div>

      <!-- Center agy96 -->
      <div class="center" id="agyCenter" aria-label="agy96">
        <div class="agyTag">agy96</div>
        <div class="pixel">
          <div class="hair"></div>
          <div class="face"></div>
          <div class="glasses">
            <div class="side"></div>
            <div class="lens"></div>
            <div class="bridge"></div>
            <div class="lens"></div>
            <div class="side"></div>
          </div>
          <div class="body"></div>
          <div class="pants"></div>
          <div class="shoes"></div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- BGM -->
<audio id="bgm" src="./arcade.mp3" loop></audio>

<script>
/* ===== BGM (plays after first tap) ===== */
const bgm = document.getElementById("bgm");
bgm.volume = 0.5;
function tryPlayBgm(){
  bgm.play().then(()=>localStorage.setItem("bgmPlaying","true")).catch(()=>{});
}
if (localStorage.getItem("bgmPlaying")==="true") tryPlayBgm();

/* ===== Prompt system (map stays same, question changes) ===== */
const prompts = [
  {
    q: "Where will you get some shiok and numbing food?",
    correct: "chinatown",
    next: "./chinatown.html"
  },
  // Later we‚Äôll add more prompts here, e.g.
  // { q: "Where has the most greenery?", correct:"macritchie", next:"./macritchie.html" }
];

let promptIndex = 0;
let current = prompts[promptIndex];

const questionText = document.getElementById("questionText");
const tryAgain = document.getElementById("tryAgain");
const agyCenter = document.getElementById("agyCenter");

function setPrompt(i){
  promptIndex = i;
  current = prompts[promptIndex];
  questionText.textContent = current.q;
  tryAgain.classList.remove("show");
}
setPrompt(0);

/* ===== Jump twice + show try again ===== */
function jumpTwice(){
  agyCenter.classList.remove("jumpTwice");
  // force reflow so animation restarts
  void agyCenter.offsetWidth;
  agyCenter.classList.add("jumpTwice");
  tryAgain.classList.add("show");
}

/* ===== Click handling ===== */
document.querySelectorAll(".spot").forEach(el=>{
  el.addEventListener("click", ()=>{
    tryPlayBgm();

    const pick = el.dataset.place;
    if (pick === current.correct){
      location.href = current.next;
    } else {
      jumpTwice();
    }
  });
});

/* ===== Pixel art helpers ===== */
function px(ctx, x,y,w,h,color){
  ctx.fillStyle = color;
  ctx.fillRect(x,y,w,h);
}
function clear(ctx){
  ctx.clearRect(0,0,ctx.canvas.width, ctx.canvas.height);
  // transparent background; the spot already has its own background
}

/* ===== Chinatown: red lanterns ===== */
function drawLanterns(canvasId){
  const c = document.getElementById(canvasId);
  const ctx = c.getContext("2d");
  clear(ctx);

  // simple hanging bar
  px(ctx, 10, 16, 76, 6, "#d1b15a");
  // 3 lanterns
  const lantern = (cx)=>{
    px(ctx, cx-10, 24, 20, 24, "#d22b2b");
    px(ctx, cx-12, 28, 4, 16, "#b01f1f");
    px(ctx, cx+8, 28, 4, 16, "#b01f1f");
    px(ctx, cx-8, 28, 16, 2, "#f2c94c");
    px(ctx, cx-8, 34, 16, 2, "#f2c94c");
    px(ctx, cx-2, 48, 4, 18, "#d1b15a"); // tassel
    px(ctx, cx-6, 66, 12, 4, "#d22b2b");
  };
  lantern(26);
  lantern(48);
  lantern(70);

  // tiny glow pixels
  px(ctx, 24, 32, 4, 6, "#ffe08a");
  px(ctx, 46, 30, 4, 8, "#ffe08a");
  px(ctx, 68, 34, 4, 6, "#ffe08a");
}

/* ===== MacRitchie: trees ===== */
function drawTrees(canvasId){
  const c = document.getElementById(canvasId);
  const ctx = c.getContext("2d");
  clear(ctx);

  // ground
  px(ctx, 10, 70, 76, 14, "#2b8c3a");

  const tree = (x, y, size)=>{
    // trunk
    px(ctx, x+size*2, y+size*4, size, size*4, "#6b3f2a");
    // canopy
    px(ctx, x, y, size*5, size*4, "#3a8f44");
    px(ctx, x+size, y-size, size*3, size, "#58b15f");
    px(ctx, x+size, y+size, size*3, size, "#58b15f");
  };

  tree(16, 26, 4);
  tree(46, 20, 5);
  tree(62, 34, 3);

  // sparkles
  px(ctx, 24, 62, 2,2,"rgba(255,255,255,0.35)");
  px(ctx, 54, 60, 2,2,"rgba(255,255,255,0.35)");
}

/* ===== Waterloo: pagoda vibe ===== */
function drawPagoda(canvasId){
  const c = document.getElementById(canvasId);
  const ctx = c.getContext("2d");
  clear(ctx);

  // base shadow
  px(ctx, 18, 72, 60, 10, "rgba(0,0,0,0.18)");

  // 3-tier pagoda, simplified
  // bottom tier
  px(ctx, 18, 56, 60, 12, "#d9b27c");
  px(ctx, 10, 52, 76, 6, "#e06a2c"); // roof edge
  px(ctx, 18, 48, 60, 6, "#c75422");

  // middle tier
  px(ctx, 26, 36, 44, 10, "#d9b27c");
  px(ctx, 20, 32, 56, 6, "#e06a2c");
  px(ctx, 26, 28, 44, 6, "#c75422");

  // top tier
  px(ctx, 34, 18, 28, 8, "#d9b27c");
  px(ctx, 30, 14, 36, 6, "#e06a2c");
  px(ctx, 34, 10, 28, 6, "#c75422");

  // spire
  px(ctx, 46, 6, 4, 8, "#2b2b3a");
  px(ctx, 44, 4, 8, 3, "#7a7a8a");
}

/* ===== Stadium: field + track ===== */
function drawStadium(canvasId){
  const c = document.getElementById(canvasId);
  const ctx = c.getContext("2d");
  clear(ctx);

  // outer stands
  px(ctx, 10, 12, 76, 72, "#d7dbe5");
  px(ctx, 14, 16, 68, 64, "#eef1f6");

  // field
  px(ctx, 22, 30, 52, 38, "#57b15f");
  // markings
  px(ctx, 24, 32, 48, 2, "#ffffff");
  px(ctx, 24, 64, 48, 2, "#ffffff");
  px(ctx, 46, 32, 2, 34, "#ffffff");
  // center circle-ish
  px(ctx, 44, 46, 6, 6, "#ffffff");
  px(ctx, 46, 48, 2, 2, "#57b15f");

  // top blue strip (sky/roof)
  px(ctx, 22, 22, 52, 6, "#4aa3d6");
}

/* Draw all icons */
drawLanterns("chinatownIcon");
drawTrees("macritchieIcon");
drawPagoda("waterlooIcon");
drawStadium("stadiumIcon");
</script>
</body>
</html>
