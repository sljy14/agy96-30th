<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Map view</title>

<style>
  :root{
    --maxw: 420px;

    /* Option 1: soft pixel town */
    --town-base1: #c7efd1;
    --town-base2: #b6e4c3;
    --town-path1: rgba(255,255,255,0.18);
    --town-path2: rgba(0,0,0,0.06);

    --card: rgba(255,255,255,0.10);
    --stroke: rgba(255,255,255,0.16);
    --shadow: rgba(0,0,0,0.18);
  }

  html,body{
    margin:0;height:100%;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
    color:#fff;

    background:
      radial-gradient(900px 520px at 50% 22%, rgba(120,255,235,0.12), transparent 62%),
      radial-gradient(900px 520px at 50% 78%, rgba(160,120,255,0.10), transparent 62%),
      linear-gradient(160deg,#06202a,#070714);
  }

  .wrap{
    height:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    padding:16px 14px 14px;
    box-sizing:border-box;
  }

  h1{
    margin:6px 0 6px;
    font-weight:1000;
    letter-spacing:-0.5px;
    font-size:26px;
    text-align:center;
  }

  .sub{
    margin:0 0 10px;
    opacity:0.86;
    text-align:center;
    font-size:13px;
  }

  .qLine{
    width:min(var(--maxw), 94vw);
    text-align:center;
    font-size:15px;
    font-weight:900;
    letter-spacing:0.2px;
    margin:6px 0 8px;
    line-height:1.25;
  }

  .tryAgain{
    width:min(var(--maxw), 94vw);
    text-align:center;
    margin:2px 0 10px;
    font-weight:1000;
    color:#ffd0d0;
    display:none;
  }
  .tryAgain.show{ display:block; }

  .mapCard{
    width:min(var(--maxw), 94vw);
    border:1px solid rgba(255,255,255,0.14);
    background:rgba(255,255,255,0.06);
    border-radius:18px;
    padding:12px;
    box-sizing:border-box;
  }

  .stage{
    position:relative;
    width:100%;
    aspect-ratio: 1 / 1;
    border-radius:14px;
    overflow:hidden;
    border:1px solid rgba(255,255,255,0.10);

    background:
      radial-gradient(120% 120% at 50% 50%, rgba(0,0,0,0.00) 55%, rgba(0,0,0,0.12) 100%),
      linear-gradient(90deg, transparent 0 42%, var(--town-path1) 42% 58%, transparent 58% 100%),
      linear-gradient(180deg, transparent 0 42%, var(--town-path1) 42% 58%, transparent 58% 100%),
      radial-gradient(2px 2px at 12% 18%, rgba(0,0,0,0.08) 45%, transparent 46%),
      radial-gradient(2px 2px at 38% 62%, rgba(0,0,0,0.08) 45%, transparent 46%),
      radial-gradient(2px 2px at 74% 34%, rgba(0,0,0,0.08) 45%, transparent 46%),
      radial-gradient(2px 2px at 86% 78%, rgba(0,0,0,0.08) 45%, transparent 46%),
      radial-gradient(2px 2px at 24% 82%, rgba(0,0,0,0.06) 45%, transparent 46%),
      linear-gradient(180deg, rgba(255,255,255,0.10), rgba(0,0,0,0.06)),
      linear-gradient(180deg, var(--town-base1), var(--town-base2));
  }

  .spot{
    position:absolute;
    width:104px;
    height:104px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:14px;
    background:rgba(255,255,255,0.12);
    border:1px solid rgba(0,0,0,0.10);
    box-shadow: 0 10px 28px rgba(0,0,0,0.14);
    cursor:pointer;
    user-select:none;
    -webkit-tap-highlight-color: transparent;

    transform: translateY(0);
    transition: transform 120ms ease, box-shadow 120ms ease;
    animation: floaty 2.8s ease-in-out infinite;
  }
  .spot:nth-child(1){ animation-delay: 0.00s; }
  .spot:nth-child(2){ animation-delay: 0.18s; }
  .spot:nth-child(3){ animation-delay: 0.35s; }
  .spot:nth-child(4){ animation-delay: 0.52s; }

  @keyframes floaty{
    0%,100%{ transform: translateY(0); }
    50%{ transform: translateY(-3px); }
  }

  .spot:active{
    transform: translateY(0) scale(0.98);
    box-shadow: 0 8px 20px rgba(0,0,0,0.18);
  }

  .label{
    position:absolute;
    top:-24px;
    left:50%;
    transform:translateX(-50%);
    font-weight:1000;
    font-size:12px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.14);
    background:rgba(0,0,0,0.22);
    backdrop-filter: blur(6px);
    box-shadow: 0 8px 18px rgba(0,0,0,0.22);
    white-space:nowrap;
    pointer-events:none;
  }

  canvas.icon{
    width:78px;
    height:78px;
    image-rendering:pixelated;
  }

  /* ‚úÖ NEW: pull spots away from the borders (looks less cramped)
     Feel free to tweak these 4 numbers. */
  #stadiumSpot   { left:32px; top:26px; }
  #waterlooSpot  { right:32px; top:26px; }
  #chinatownSpot { left:32px; bottom:26px; }
  #macritchieSpot{ right:32px; bottom:26px; }

  .center{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width:110px;
    height:150px;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
  }

  .agyTag{
    position:absolute;
    top:-22px;
    left:50%;
    transform:translateX(-50%);
    font-weight:1000;
    font-size:12px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.14);
    background:rgba(0,0,0,0.22);
    backdrop-filter: blur(6px);
    box-shadow: 0 8px 18px rgba(0,0,0,0.22);
  }

  .pixel{ width:92px; height:132px; position:relative; }
  .hair{
    position:absolute; width:66px; height:92px; background:#000;
    top:0; left:50%; transform:translateX(-50%); border-radius:10px;
  }
  .face{
    position:absolute; width:44px; height:50px; background:#f1c7a6;
    top:24px; left:50%; transform:translateX(-50%); border-radius:2px;
  }
  .glasses{
    position:absolute; top:43px; left:50%; transform:translateX(-50%);
    display:flex; align-items:center;
  }
  .glasses .side{ width:10px; height:4px; background:#000; }
  .glasses .lens{ width:16px; height:13px; border:3px solid #000; box-sizing:border-box; }
  .glasses .bridge{ width:8px; height:4px; background:#000; }

  .body{
    position:absolute; top:82px; left:50%; transform:translateX(-50%);
    width:58px; height:36px; background:#c1272d;
  }
  .pants{
    position:absolute; top:118px; left:50%; transform:translateX(-50%);
    width:60px; height:22px; background:#0e0e18;
  }
  .shoes{
    position:absolute; top:140px; left:50%; transform:translateX(-50%);
    width:54px; height:9px; background:#fff;
  }

  @keyframes hop {
    0%{ transform:translate(-50%,-50%) translateY(0); }
    25%{ transform:translate(-50%,-50%) translateY(-10px); }
    50%{ transform:translate(-50%,-50%) translateY(0); }
    75%{ transform:translate(-50%,-50%) translateY(-10px); }
    100%{ transform:translate(-50%,-50%) translateY(0); }
  }
  .jumpTwice{ animation: hop 420ms ease-in-out 1; }

  @media (max-width: 360px){
    h1{ font-size:24px; }
    .qLine{ font-size:14px; }
    .spot{ width:98px; height:98px; }
    canvas.icon{ width:74px; height:74px; }

    /* on tiny screens, reduce inset a bit */
    #stadiumSpot   { left:24px; top:22px; }
    #waterlooSpot  { right:24px; top:22px; }
    #chinatownSpot { left:24px; bottom:22px; }
    #macritchieSpot{ right:24px; bottom:22px; }
  }
</style>
</head>

<body>
<div class="wrap">
  <h1>Map view üó∫Ô∏è</h1>
  <div class="sub">Tap on the right place!</div>

  <div class="qLine" id="questionText">...</div>
  <div class="tryAgain" id="tryAgain">Try again!</div>

  <div class="mapCard">
    <div class="stage" id="stage">

      <div class="spot" id="stadiumSpot" data-place="stadium" role="button" aria-label="Stadium">
        <div class="label">Stadium</div>
        <canvas class="icon" id="stadiumIcon" width="96" height="96"></canvas>
      </div>

      <div class="spot" id="waterlooSpot" data-place="waterloo" role="button" aria-label="Waterloo">
        <div class="label">Waterloo</div>
        <canvas class="icon" id="waterlooIcon" width="96" height="96"></canvas>
      </div>

      <div class="spot" id="chinatownSpot" data-place="chinatown" role="button" aria-label="Chinatown">
        <div class="label">Chinatown</div>
        <canvas class="icon" id="chinatownIcon" width="96" height="96"></canvas>
      </div>

      <div class="spot" id="macritchieSpot" data-place="macritchie" role="button" aria-label="MacRitchie">
        <div class="label">MacRitchie</div>
        <canvas class="icon" id="macritchieIcon" width="96" height="96"></canvas>
      </div>

      <div class="center" id="agyCenter" aria-label="agy96">
        <div class="agyTag">agy96</div>
        <div class="pixel">
          <div class="hair"></div>
          <div class="face"></div>
          <div class="glasses">
            <div class="side"></div>
            <div class="lens"></div>
            <div class="bridge"></div>
            <div class="lens"></div>
            <div class="side"></div>
          </div>
          <div class="body"></div>
          <div class="pants"></div>
          <div class="shoes"></div>
        </div>
      </div>

    </div>
  </div>
</div>

<audio id="bgm" src="./arcade.mp3" loop></audio>

<script>
/* ===== BGM (plays after first tap) ===== */
const bgm = document.getElementById("bgm");
bgm.volume = 0.5;
function tryPlayBgm(){
  bgm.play().then(()=>localStorage.setItem("bgmPlaying","true")).catch(()=>{});
}
if (localStorage.getItem("bgmPlaying")==="true") tryPlayBgm();

/* ===== Prompt system (ALL 4 questions) =====
   Uses localStorage.mapPromptIndex to control which question is active. */
const prompts = [
  { q: "Where will you get some shiok and numbing food?", correct: "chinatown", next: "./chinatown.html" },
  { q: "Where will you get your food stolen from you?", correct: "macritchie", next: "./macritchie.html" },
  { q: "Where would your toes hurt the most?", correct: "waterloo", next: "./waterloo.html" },
  { q: "Where would you be more than happy for your ear drums to hurt?", correct: "stadium", next: "./stadium.html" }
];

let promptIndex = Number(localStorage.getItem("mapPromptIndex") || 0);
if (!Number.isFinite(promptIndex) || promptIndex < 0) promptIndex = 0;

// ‚úÖ allow an "end state" index after stadium
// 0..3 = prompts, 4 = rooftop
const END_INDEX = prompts.length; // 4
if (promptIndex > END_INDEX) promptIndex = 0; // only reset if truly corrupted
if (promptIndex === END_INDEX){
  location.replace("./rooftop.html"); // change filename if yours is different
}


let current = prompts[promptIndex];

const questionText = document.getElementById("questionText");
const tryAgain = document.getElementById("tryAgain");
const agyCenter = document.getElementById("agyCenter");

function setPrompt(i){
  promptIndex = i;
  current = prompts[promptIndex];
  questionText.textContent = current.q;
  tryAgain.classList.remove("show");
}
setPrompt(promptIndex);

function jumpTwice(){
  agyCenter.classList.remove("jumpTwice");
  void agyCenter.offsetWidth;
  agyCenter.classList.add("jumpTwice");
  tryAgain.classList.add("show");
}

/* ===== Click handling ===== */
document.querySelectorAll(".spot").forEach(el=>{
  el.addEventListener("click", ()=>{
    tryPlayBgm();

    const pick = el.dataset.place;
    if (pick === current.correct){
      // advance prompt for next time you return to map
      localStorage.setItem("mapPromptIndex", String(promptIndex + 1)); // ‚úÖ allow 4
location.href = current.next;
    } else {
      jumpTwice();
    }
  });
});

/* ===== Pixel art drawing ===== */
function px(ctx, x,y,w,h,color){
  ctx.fillStyle = color; ctx.fillRect(x,y,w,h);
}
function clear(ctx){ ctx.clearRect(0,0,ctx.canvas.width, ctx.canvas.height); }

function drawLanterns(id){
  const c = document.getElementById(id);
  const ctx = c.getContext("2d");
  clear(ctx);
  px(ctx, 10, 16, 76, 6, "#d1b15a");
  const lantern = (cx)=>{
    px(ctx, cx-10, 24, 20, 24, "#d22b2b");
    px(ctx, cx-12, 28, 4, 16, "#b01f1f");
    px(ctx, cx+8, 28, 4, 16, "#b01f1f");
    px(ctx, cx-8, 28, 16, 2, "#f2c94c");
    px(ctx, cx-8, 34, 16, 2, "#f2c94c");
    px(ctx, cx-2, 48, 4, 18, "#d1b15a");
    px(ctx, cx-6, 66, 12, 4, "#d22b2b");
  };
  lantern(26); lantern(48); lantern(70);
  px(ctx, 24, 32, 4, 6, "#ffe08a");
  px(ctx, 46, 30, 4, 8, "#ffe08a");
  px(ctx, 68, 34, 4, 6, "#ffe08a");
}

function drawTrees(id){
  const c = document.getElementById(id);
  const ctx = c.getContext("2d");
  clear(ctx);
  px(ctx, 10, 70, 76, 14, "#2b8c3a");

  const tree = (x, y, s)=>{
    px(ctx, x+s*2, y+s*4, s, s*4, "#6b3f2a");
    px(ctx, x, y, s*5, s*4, "#3a8f44");
    px(ctx, x+s, y-s, s*3, s, "#58b15f");
    px(ctx, x+s, y+s, s*3, s, "#58b15f");
  };
  tree(16, 26, 4);
  tree(46, 20, 5);
  tree(62, 34, 3);
}

function drawPagoda(id){
  const c = document.getElementById(id);
  const ctx = c.getContext("2d");
  clear(ctx);

  px(ctx, 18, 72, 60, 10, "rgba(0,0,0,0.18)");
  px(ctx, 18, 56, 60, 12, "#d9b27c");
  px(ctx, 10, 52, 76, 6, "#e06a2c");
  px(ctx, 18, 48, 60, 6, "#c75422");

  px(ctx, 26, 36, 44, 10, "#d9b27c");
  px(ctx, 20, 32, 56, 6, "#e06a2c");
  px(ctx, 26, 28, 44, 6, "#c75422");

  px(ctx, 34, 18, 28, 8, "#d9b27c");
  px(ctx, 30, 14, 36, 6, "#e06a2c");
  px(ctx, 34, 10, 28, 6, "#c75422");

  px(ctx, 46, 6, 4, 8, "#2b2b3a");
  px(ctx, 44, 4, 8, 3, "#7a7a8a");
}

function drawStadium(id){
  const c = document.getElementById(id);
  const ctx = c.getContext("2d");
  clear(ctx);

  px(ctx, 10, 12, 76, 72, "#d7dbe5");
  px(ctx, 14, 16, 68, 64, "#eef1f6");
  px(ctx, 22, 30, 52, 38, "#57b15f");
  px(ctx, 24, 32, 48, 2, "#ffffff");
  px(ctx, 24, 64, 48, 2, "#ffffff");
  px(ctx, 46, 32, 2, 34, "#ffffff");
  px(ctx, 44, 46, 6, 6, "#ffffff");
  px(ctx, 46, 48, 2, 2, "#57b15f");
  px(ctx, 22, 22, 52, 6, "#4aa3d6");
}

drawLanterns("chinatownIcon");
drawTrees("macritchieIcon");
drawPagoda("waterlooIcon");
drawStadium("stadiumIcon");
</script>
</body>
</html>
