<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>MacRitchie Hike</title>
  <style>
    :root{
      --bg1:#071c1f;
      --bg2:#0b2a2f;
      --panel: rgba(10, 22, 28, 0.55);
      --panel2: rgba(255,255,255,0.08);
      --text:#eaf6ff;
      --muted: rgba(234,246,255,0.75);
      --accent:#9ff0c8;
      --warn:#ffb870;
    }

    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 600px at 50% -10%, #123d45, #06161a);
      color: var(--text);
    }

    .wrap{
      min-height:100svh;
      display:flex;
      justify-content:center;
      padding: 18px 14px 24px;
    }

    .card{
      width:min(520px, 100%);
      border-radius: 26px;
      background: linear-gradient(180deg, rgba(7, 24, 28, 0.7), rgba(5, 18, 22, 0.65));
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 30px 80px rgba(0,0,0,0.55);
      overflow:hidden;
    }

    .header{
      padding: 22px 18px 14px;
      text-align:center;
    }

    h1{
      margin: 0 0 6px;
      font-size: 34px;
      line-height: 1.1;
      font-weight: 800;
      letter-spacing: -0.02em;
      text-shadow: 0 2px 10px rgba(0,0,0,0.4);
    }
    .sub{
      margin: 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.45;
    }

    .hud{
      display:flex;
      gap: 10px;
      justify-content: space-between;
      padding: 0 16px 12px;
    }

    .pill{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      border-radius: 999px;
      padding: 12px 12px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      font-weight: 700;
      letter-spacing: 0.2px;
      min-width: 0;
    }
    .pill small{
      color: var(--muted);
      font-weight: 600;
      letter-spacing: 0;
    }

    .stage{
      padding: 10px 14px 16px;
    }

    .frame{
      border-radius: 22px;
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.10);
      padding: 10px;
    }

    canvas{
      width:100%;
      height:auto;
      display:block;
      border-radius: 18px;
      image-rendering: pixelated;
      background: #061319;
      touch-action: manipulation;
    }

    .footer{
      padding: 14px 16px 20px;
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:center;
      flex-wrap: wrap;
    }

    .btn{
      appearance:none;
      border: 0;
      border-radius: 999px;
      padding: 14px 16px;
      font-weight: 800;
      letter-spacing: 0.2px;
      background: rgba(255,255,255,0.10);
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.16);
      cursor:pointer;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(180deg, rgba(159,240,200,0.22), rgba(159,240,200,0.12));
      border: 1px solid rgba(159,240,200,0.28);
    }
    .hint{
      width: 100%;
      text-align:center;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }

    /* Pages */
    .page{ display:none; }
    .page.active{ display:block; }

    /* View page */
    .viewWrap{
      padding: 14px;
    }
    .viewTitle{
      text-align:center;
      font-weight: 900;
      font-size: 22px;
      margin: 6px 0 10px;
      letter-spacing: -0.01em;
    }
    .viewSubtitle{
      text-align:center;
      color: var(--muted);
      margin: 0 0 12px;
      font-size: 13px;
    }
    .viewFrame{
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.10);
      overflow:hidden;
      background: rgba(0,0,0,0.18);
    }
    .viewCanvas{
      width:100%;
      display:block;
      image-rendering: pixelated;
      background:#061319;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">

      <!-- GAME PAGE -->
      <section id="gamePage" class="page active">
        <div class="header">
          <h1>Welcome to the MacRitchie hike! ü•æ</h1>
          <p class="sub">Tap to jump onto the logs.<br/>Land on 10 logs to reach the top.</p>
        </div>

        <div class="hud">
          <div class="pill"><span>ü™µ</span><span>Logs:&nbsp;<strong id="logsCount">0</strong>&nbsp;<small>/ 10</small></span></div>
          <div class="pill"><span>üôà</span><span>Slips:&nbsp;<strong id="slipsCount">0</strong></span></div>
        </div>

        <div class="stage">
          <div class="frame">
            <canvas id="game" width="360" height="520" aria-label="MacRitchie hike game"></canvas>
          </div>
        </div>

        <div class="footer">
          <button id="startBtn" class="btn primary">Start</button>
          <button id="resetBtn" class="btn">Reset</button>
          <div class="hint">
            Tip: logs move left-right. Tap at the right moment to land cleanly.
          </div>
        </div>
      </section>

      <!-- VIEW PAGE -->
      <section id="viewPage" class="page">
        <div class="viewWrap">
          <div class="viewTitle">Enjoy the view, you deserve it! üåÖ</div>
          <div class="viewSubtitle">MacRitchie complete ‚Äî you made it to the top.</div>

          <div class="viewFrame">
            <canvas id="view" class="viewCanvas" width="360" height="420" aria-label="View scene"></canvas>
          </div>

          <div class="footer" style="padding-top:14px;">
            <button id="nextBtn" class="btn primary">I‚Äôm ready for my next adventure!</button>
            <button id="replayBtn" class="btn">Replay MacRitchie</button>
          </div>
        </div>
      </section>

    </div>
  </div>

<script>
/* =========================
   MACRITCHIE ‚Äî PIXEL ARCADE
   =========================
   Mechanics:
   - Logs move side-to-side
   - Tap to jump to the next log
   - Success if your x overlaps the target log at tap moment
   - After 10 successful landings -> view page
*/

(() => {
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");
  ctx.imageSmoothingEnabled = false;

  const logsCountEl = document.getElementById("logsCount");
  const slipsCountEl = document.getElementById("slipsCount");

  const startBtn = document.getElementById("startBtn");
  const resetBtn = document.getElementById("resetBtn");

  const gamePage = document.getElementById("gamePage");
  const viewPage = document.getElementById("viewPage");

  const viewCanvas = document.getElementById("view");
  const vctx = viewCanvas.getContext("2d");
  vctx.imageSmoothingEnabled = false;

  const nextBtn = document.getElementById("nextBtn");
  const replayBtn = document.getElementById("replayBtn");

  // ------- GAME CONFIG -------
  const GOAL = 10;
  const SLIP_LIMIT = 999; // no forced game over unless you want it
  const LOG_W = 110;
  const LOG_H = 16;

  const world = {
    running: false,
    time: 0,
    landed: 0,
    slips: 0,
    currentIndex: 0,      // which target log we are jumping to next
    flash: 0,             // small feedback flash
    shake: 0,             // small shake on slip
  };

  const player = {
    // fixed-ish position: this is a TIMING game (logs move)
    x: canvas.width * 0.5,
    y: canvas.height - 88,
    w: 20,
    h: 26,
    colorTop: "#f3d6c3",
    colorBody: "#d74a4a",
    colorHair: "#161616",
    glasses: true,
  };

  let logs = [];
  let birds = [];

  // ------- HELPERS -------
  const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
  const rand = (a, b) => a + Math.random() * (b - a);
  const randi = (a, b) => Math.floor(rand(a, b));

  function resetGame() {
    world.running = false;
    world.time = 0;
    world.landed = 0;
    world.slips = 0;
    world.currentIndex = 0;
    world.flash = 0;
    world.shake = 0;

    // Create 10 logs stacked upward
    logs = [];
    const startY = canvas.height - 120;
    const gapY = 38;

    for (let i = 0; i < GOAL; i++) {
      const y = startY - i * gapY;
      logs.push({
        x: rand(18, canvas.width - LOG_W - 18),
        y,
        w: LOG_W,
        h: LOG_H,
        dir: Math.random() > 0.5 ? 1 : -1,
        speed: rand(1.0, 2.2),
        tint: randi(0, 2), // for slight color variation
      });
    }

    // Player starts near bottom; first target is logs[0]
    player.x = canvas.width * 0.5;
    player.y = canvas.height - 88;

    // Birds (3) with simple A/B/C bob positions
    birds = Array.from({ length: 3 }, (_, i) => ({
      x: rand(30, canvas.width - 30),
      y: rand(60, 170),
      baseY: 0,
      phase: randi(0, 3),  // 0=A,1=B,2=C
      t: 0,
      speed: rand(0.6, 1.1),
    }));
    birds.forEach(b => b.baseY = b.y);

    updateHUD();
    draw(); // paint initial frame
  }

  function updateHUD() {
    logsCountEl.textContent = String(world.landed);
    slipsCountEl.textContent = String(world.slips);
  }

  // ------- INPUT (Tap / Click) -------
  function onTap() {
    if (!world.running) return;
    if (world.currentIndex >= GOAL) return;

    const target = logs[world.currentIndex];

    // Overlap check in X
    const pxL = player.x - player.w/2;
    const pxR = player.x + player.w/2;
    const lxL = target.x;
    const lxR = target.x + target.w;

    const overlap = (pxR > lxL) && (pxL < lxR);

    if (overlap) {
      // SUCCESS: snap player to log
      player.y = target.y - player.h + 2;
      world.landed++;
      world.currentIndex++;
      world.flash = 10;
      updateHUD();

      if (world.landed >= GOAL) {
        // Transition to view page
        setTimeout(() => {
          world.running = false;
          goToViewPage();
        }, 220);
      }
    } else {
      // SLIP
      world.slips++;
      world.shake = 8;
      updateHUD();

      // optional: small "fall" feeling (just a quick drop)
      player.y = clamp(player.y + 14, 40, canvas.height - 50);

      if (world.slips >= SLIP_LIMIT) {
        // you can add a game-over screen if you ever want
      }
    }
  }

  canvas.addEventListener("pointerdown", (e) => {
    e.preventDefault();
    onTap();
  }, { passive: false });

  // ------- UPDATE LOOP -------
  function update(dt) {
    world.time += dt;

    // logs move left-right
    for (const log of logs) {
      log.x += log.dir * log.speed;
      if (log.x <= 10) { log.x = 10; log.dir *= -1; }
      if (log.x + log.w >= canvas.width - 10) { log.x = canvas.width - 10 - log.w; log.dir *= -1; }
    }

    // birds bob between A/B/C positions + drift a tiny bit
    for (const b of birds) {
      b.t += dt * b.speed;
      // switch phase occasionally for that ‚ÄúA->B->C‚Äù vibe
      if (b.t >= 18) {
        b.t = 0;
        b.phase = (b.phase + 1) % 3;
      }
      const offsets = [-4, 0, 3];
      b.y = b.baseY + offsets[b.phase];

      // tiny lateral drift (wrap)
      b.x += 0.12 * b.speed;
      if (b.x > canvas.width + 10) b.x = -10;
    }

    if (world.flash > 0) world.flash -= 1;
    if (world.shake > 0) world.shake -= 1;
  }

  // ------- DRAW (PIXEL ART) -------
  function drawBackground() {
    // Pixel ‚Äúforest‚Äù vibe (2D arcade, not soft)
    // Sky gradient blocks
    const g = ctx.createLinearGradient(0, 0, 0, canvas.height);
    g.addColorStop(0, "#08242a");
    g.addColorStop(0.55, "#061b20");
    g.addColorStop(1, "#041015");
    ctx.fillStyle = g;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Vertical ‚Äútrees‚Äù columns
    for (let x = 0; x < canvas.width; x += 18) {
      const w = 18;
      const shade = (x/18) % 2 === 0 ? "rgba(0,0,0,0.18)" : "rgba(255,255,255,0.03)";
      ctx.fillStyle = shade;
      ctx.fillRect(x, 0, w, canvas.height);
    }

    // Dark canopy blocks near top
    ctx.fillStyle = "rgba(0,0,0,0.25)";
    for (let i=0;i<12;i++){
      const bx = i * 32;
      ctx.fillRect(bx, 60 + (i%2)*8, 34, 26);
    }

    // Hanging vines (pixel strings)
    ctx.fillStyle = "rgba(121, 214, 148, 0.18)";
    for (let i=0;i<10;i++){
      const vx = randi(0, canvas.width);
      const len = randi(60, 170);
      for (let y=0;y<len;y+=6){
        ctx.fillRect(vx, y, 2, 4);
      }
    }
  }

  function drawBird(b) {
    // tiny pixel bird (like a V)
    const x = Math.round(b.x);
    const y = Math.round(b.y);
    ctx.fillStyle = "rgba(234,246,255,0.75)";
    ctx.fillRect(x, y, 2, 2);
    ctx.fillRect(x-3, y+1, 2, 2);
    ctx.fillRect(x+3, y+1, 2, 2);
  }

  function drawLogs() {
    for (const log of logs) {
      // simple pixel log plank with a darker underside
      const base = log.tint === 0 ? "#a56a3a" : (log.tint === 1 ? "#9b5f34" : "#b1723e");
      ctx.fillStyle = base;
      ctx.fillRect(Math.round(log.x), Math.round(log.y), log.w, log.h);

      ctx.fillStyle = "rgba(0,0,0,0.25)";
      ctx.fillRect(Math.round(log.x), Math.round(log.y + log.h - 4), log.w, 4);

      // light grain lines
      ctx.fillStyle = "rgba(255,255,255,0.10)";
      ctx.fillRect(Math.round(log.x + 10), Math.round(log.y + 5), log.w - 20, 1);
      ctx.fillRect(Math.round(log.x + 14), Math.round(log.y + 9), log.w - 28, 1);
    }
  }

  function drawPlayer() {
    const px = Math.round(player.x - player.w/2);
    const py = Math.round(player.y);

    // shadow
    ctx.fillStyle = "rgba(0,0,0,0.35)";
    ctx.fillRect(px + 2, py + player.h + 4, player.w - 4, 3);

    // hair / head
    ctx.fillStyle = player.colorHair;
    ctx.fillRect(px + 2, py, player.w - 4, 8);

    ctx.fillStyle = player.colorTop;
    ctx.fillRect(px + 4, py + 6, player.w - 8, 10);

    // glasses
    ctx.fillStyle = "rgba(0,0,0,0.75)";
    ctx.fillRect(px + 4, py + 9, 5, 2);
    ctx.fillRect(px + player.w - 9, py + 9, 5, 2);
    ctx.fillRect(px + 9, py + 9, 2, 1);

    // body
    ctx.fillStyle = player.colorBody;
    ctx.fillRect(px + 2, py + 16, player.w - 4, 10);

    // legs
    ctx.fillStyle = "#0f1113";
    ctx.fillRect(px + 4, py + 26, 5, 8);
    ctx.fillRect(px + player.w - 9, py + 26, 5, 8);
  }

  function drawTopBanner() {
    // subtle ‚Äútarget‚Äù indicator for next log
    if (world.currentIndex < GOAL) {
      const t = logs[world.currentIndex];
      ctx.fillStyle = "rgba(159,240,200,0.25)";
      ctx.fillRect(Math.round(t.x), Math.round(t.y - 6), t.w, 3);
    }

    if (world.flash > 0) {
      ctx.fillStyle = "rgba(159,240,200,0.10)";
      ctx.fillRect(0,0,canvas.width,canvas.height);
    }
  }

  function draw() {
    // small shake on slip
    const shakeX = world.shake > 0 ? (Math.random() * 4 - 2) : 0;
    const shakeY = world.shake > 0 ? (Math.random() * 4 - 2) : 0;

    ctx.save();
    ctx.translate(shakeX, shakeY);

    drawBackground();
    birds.forEach(drawBird);
    drawLogs();
    drawPlayer();
    drawTopBanner();

    ctx.restore();
  }

  // ------- RAF LOOP -------
  let last = 0;
  function loop(ts) {
    if (!last) last = ts;
    const dt = Math.min(33, ts - last); // cap dt
    last = ts;

    if (world.running) {
      update(dt);
    }
    draw();

    requestAnimationFrame(loop);
  }

  // ------- VIEW PAGE SCENE -------
  const view = {
    t: 0,
    clouds: [
      { x: -80, y: 60, s: 0.6, sp: 0.18 },
      { x: 90, y: 95, s: 0.8, sp: 0.12 },
      { x: 220, y: 70, s: 0.7, sp: 0.14 }
    ]
  };

  function drawViewScene(dt) {
    view.t += dt;

    const W = viewCanvas.width, H = viewCanvas.height;

    // simple arcade sunset sky (similar to your dcop vibe)
    const g = vctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0, "#76c8ff");
    g.addColorStop(0.45, "#ffd28c");
    g.addColorStop(1, "#12424b");
    vctx.fillStyle = g;
    vctx.fillRect(0,0,W,H);

    // sun
    vctx.fillStyle = "#ffd35a";
    vctx.fillRect(280, 40, 48, 48);

    // clouds (pixel blobs) moving
    for (const c of view.clouds) {
      c.x += c.sp * dt;
      if (c.x > W + 80) c.x = -90;

      drawPixelCloud(vctx, c.x, c.y, c.s);
    }

    // grass patch
    vctx.fillStyle = "#2b7a43";
    vctx.fillRect(0, H - 110, W, 110);
    vctx.fillStyle = "rgba(0,0,0,0.20)";
    vctx.fillRect(0, H - 110, W, 6);

    // distant ‚Äúview‚Äù blocks (simple skyline / canopy)
    vctx.fillStyle = "rgba(0,0,0,0.25)";
    for (let i=0;i<8;i++){
      vctx.fillRect(i*52 + 4, H - 165 - (i%2)*8, 44, 40);
    }

    // sitting character (agy96) looking at view
    drawSittingPixelPerson(vctx, 150, H - 140);
  }

  function drawPixelCloud(c, x, y, s) {
    const px = Math.round(x), py = Math.round(y);
    c.fillStyle = "rgba(255,255,255,0.85)";
    const w = Math.round(90*s), h = Math.round(26*s);
    c.fillRect(px, py, w, h);
    c.fillRect(px + Math.round(12*s), py - Math.round(10*s), Math.round(32*s), Math.round(16*s));
    c.fillRect(px + Math.round(34*s), py - Math.round(14*s), Math.round(40*s), Math.round(20*s));
    c.fillRect(px + Math.round(56*s), py - Math.round(8*s), Math.round(28*s), Math.round(14*s));
  }

  function drawSittingPixelPerson(c, x, y) {
    // x,y = top-left-ish anchor
    const px = Math.round(x), py = Math.round(y);

    // hair/head
    c.fillStyle = "#161616";
    c.fillRect(px + 10, py, 28, 10);

    c.fillStyle = "#f3d6c3";
    c.fillRect(px + 12, py + 8, 24, 14);

    // body
    c.fillStyle = "#d74a4a";
    c.fillRect(px + 10, py + 22, 28, 14);

    // legs (sitting)
    c.fillStyle = "#0f1113";
    c.fillRect(px + 10, py + 36, 14, 8);
    c.fillRect(px + 24, py + 40, 16, 8);

    // small white shoe line
    c.fillStyle = "#eaf6ff";
    c.fillRect(px + 24, py + 46, 16, 2);
  }

  let viewLast = 0;
  function viewLoop(ts){
    if (!viewLast) viewLast = ts;
    const dt = Math.min(33, ts - viewLast);
    viewLast = ts;

    if (viewPage.classList.contains("active")) {
      drawViewScene(dt);
    }
    requestAnimationFrame(viewLoop);
  }

  function goToViewPage() {
    gamePage.classList.remove("active");
    viewPage.classList.add("active");
  }

  function goToGamePage() {
    viewPage.classList.remove("active");
    gamePage.classList.add("active");
  }

  // ------- BUTTONS -------
  startBtn.addEventListener("click", () => {
    if (!world.running) {
      world.running = true;
      startBtn.textContent = "Running‚Ä¶";
      startBtn.disabled = true;
      startBtn.style.opacity = "0.7";
    }
  });

  resetBtn.addEventListener("click", () => {
    startBtn.textContent = "Start";
    startBtn.disabled = false;
    startBtn.style.opacity = "1";
    resetGame();
  });

  replayBtn.addEventListener("click", () => {
    goToGamePage();
    startBtn.textContent = "Start";
    startBtn.disabled = false;
    startBtn.style.opacity = "1";
    resetGame();
  });

  nextBtn.addEventListener("click", () => {
    // Hook this to your overall flow (next location / page)
    // For now: just reload or redirect.
    // window.location.href = "next.html";
    alert("Hook this button to your next adventure page.");
  });

  // ------- INIT -------
  resetGame();
  requestAnimationFrame(loop);
  requestAnimationFrame(viewLoop);

})();
</script>
</body>
</html>
