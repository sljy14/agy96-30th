<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>MacRitchie Hike</title>
  <style>
    :root{
      --cardBg1: rgba(7, 24, 28, 0.74);
      --cardBg2: rgba(5, 18, 22, 0.70);
      --border: rgba(255,255,255,0.12);
      --text: #eaf6ff;
      --muted: rgba(234,246,255,0.78);
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 600px at 50% -10%, #123d45, #06161a);
      color: var(--text);
    }
    .wrap{
      min-height:100svh;
      display:flex;
      justify-content:center;
      padding: 10px 12px 14px;
    }
    .card{
      width:min(560px, 100%);
      border-radius: 24px;
      background: linear-gradient(180deg, var(--cardBg1), var(--cardBg2));
      border: 1px solid var(--border);
      box-shadow: 0 30px 80px rgba(0,0,0,0.55);
      overflow:hidden;
    }
    .page{ display:none; }
    .page.active{ display:block; }

    .header{
      padding: 14px 14px 8px;
      text-align:center;
    }
    h1{
      margin: 0 0 6px;
      font-size: 32px;
      line-height: 1.08;
      font-weight: 900;
      letter-spacing: -0.02em;
      text-shadow: 0 2px 10px rgba(0,0,0,0.35);
    }
    .sub{
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .hud{
      display:flex;
      gap: 10px;
      justify-content: space-between;
      padding: 0 14px 10px;
    }
    .pill{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      border-radius: 999px;
      padding: 10px 10px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      font-weight: 800;
      letter-spacing: 0.2px;
      min-width: 0;
    }
    .pill small{
      color: var(--muted);
      font-weight: 700;
    }

    .stage{ padding: 8px 12px 10px; }
    .frame{
      border-radius: 20px;
      background: rgba(0,0,0,0.16);
      border: 1px solid rgba(255,255,255,0.10);
      padding: 10px;
    }
    canvas{
      width:100%;
      height:auto;
      display:block;
      border-radius: 16px;
      background: #dff3ff;
      touch-action: manipulation;
    }

    .hint{
      padding: 0 16px 14px;
      text-align:center;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }

    .viewWrap{ padding: 14px 12px 12px; }
    .viewTitle{
      text-align:center;
      font-weight: 900;
      font-size: 22px;
      margin: 6px 0 8px;
      letter-spacing: -0.01em;
    }
    .viewSubtitle{
      text-align:center;
      color: var(--muted);
      margin: 0 0 10px;
      font-size: 13px;
    }
    .viewFrame{
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.10);
      overflow:hidden;
      background: rgba(0,0,0,0.16);
    }
    .footer{
      padding: 12px 16px 16px;
      display:flex;
      justify-content:center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn{
      appearance:none;
      border: 0;
      border-radius: 999px;
      padding: 14px 16px;
      font-weight: 900;
      letter-spacing: 0.2px;
      background: rgba(255,255,255,0.10);
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.16);
      cursor:pointer;
      width: 100%;
      max-width: 360px;
    }
    .btn.primary{
      background: linear-gradient(180deg, rgba(159,240,200,0.22), rgba(159,240,200,0.12));
      border: 1px solid rgba(159,240,200,0.28);
    }
    .btn:active{ transform: translateY(1px); }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">

    <!-- GAME PAGE -->
    <section id="gamePage" class="page active">
      <div class="header">
        <h1>Welcome to the MacRitchie hike! ðŸ¥¾</h1>
        <p class="sub">Tap to jump onto the logs.<br/>Land on 10 logs to reach the top.</p>
      </div>

      <div class="hud">
        <div class="pill"><span>ðŸªµ</span><span>Logs:&nbsp;<strong id="logsCount">0</strong>&nbsp;<small>/ 10</small></span></div>
        <div class="pill"><span>ðŸ™ˆ</span><span>Slips:&nbsp;<strong id="slipsCount">0</strong></span></div>
      </div>

      <div class="stage">
        <div class="frame">
          <canvas id="game" width="390" height="520" aria-label="MacRitchie hike game"></canvas>
        </div>
      </div>

    </section>

    <!-- VIEW PAGE -->
    <section id="viewPage" class="page">
      <div class="viewWrap">
        <div class="viewTitle">Enjoy the view, you deserve it! ðŸŒ…</div>
        <div class="viewSubtitle">MacRitchie complete, you made it to the top!</div>

        <div class="viewFrame">
          <canvas id="view" width="390" height="460" aria-label="View scene"></canvas>
        </div>

        <div class="footer">
          <button id="nextBtn" class="btn primary">Iâ€™m ready for my next adventure!</button>
        </div>
      </div>
    </section>

  </div>
</div>

<!-- BGM (will start on first user tap; then loops forever across pages) -->
<audio id="bgm" src="arcade.mp3" preload="auto" loop></audio>

<script>
(() => {
  // ===== DOM =====
  const gamePage = document.getElementById("gamePage");
  const viewPage = document.getElementById("viewPage");
  const logsCountEl = document.getElementById("logsCount");
  const slipsCountEl = document.getElementById("slipsCount");
  const nextBtn = document.getElementById("nextBtn");
  const bgm = document.getElementById("bgm");

  // ===== CANVAS =====
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");
  ctx.imageSmoothingEnabled = true;

  const viewCanvas = document.getElementById("view");
  const vctx = viewCanvas.getContext("2d");
  vctx.imageSmoothingEnabled = true;

  // ===== GLASSES HELPER =====
  function drawGlasses(ctx, leftX, gy, lensW, lensH, thick, gap, armLen){
    ctx.fillStyle = "#000";
    ctx.fillRect(leftX, gy, lensW, thick);
    ctx.fillRect(leftX, gy + lensH - thick, lensW, thick);
    ctx.fillRect(leftX, gy, thick, lensH);
    ctx.fillRect(leftX + lensW - thick, gy, thick, lensH);

    const rightX = leftX + lensW + gap;
    ctx.fillRect(rightX, gy, lensW, thick);
    ctx.fillRect(rightX, gy + lensH - thick, lensW, thick);
    ctx.fillRect(rightX, gy, thick, lensH);
    ctx.fillRect(rightX + lensW - thick, gy, thick, lensH);

    ctx.fillRect(leftX + lensW, gy + Math.floor(lensH/2) - 1, gap, 2);

    ctx.fillRect(leftX - armLen, gy + 2, armLen, 2);
    ctx.fillRect(rightX + lensW, gy + 2, armLen, 2);
  }

  // ===== CHINATOWN AVATAR â€” EXACT BUT (NO PLATE) =====
  // IMPORTANT: y is the FEET BASELINE
  // Shoe bottom is at y+27 (because shoes at y+22 height 5)
  const SHOE_BOTTOM_OFFSET = 27;

  function drawAgyGameplay(px, py){
    const x = px, y = py;

    // hair
    ctx.fillStyle="#000";
    ctx.fillRect(x-18, y-60, 36, 60);

    // face
    ctx.fillStyle="#f1c7a6";
    ctx.fillRect(x-12, y-44, 24, 28);

    // glasses
    const gy = y - 38;
    const lensW = 11, lensH = 9;
    const thick = 2, gap = 5, armLen = 4;
    const leftX = x - 14;
    drawGlasses(ctx, leftX, gy, lensW, lensH, thick, gap, armLen);

    // shirt
    ctx.fillStyle="#c1272d";
    ctx.fillRect(x-16, y-16, 32, 22);

    // sleeves
    ctx.fillRect(x-22, y-16, 6, 8);
    ctx.fillRect(x+16, y-16, 6, 8);

    // arms
    ctx.fillStyle="#f1c7a6";
    ctx.fillRect(x-22, y-8, 6, 10);
    ctx.fillRect(x+16, y-8, 6, 10);

    // (plate removed)

    // pants + shoes
    ctx.fillStyle="#0e0e18";
    ctx.fillRect(x-16, y+6, 32, 16);

    ctx.fillStyle="#fff";
    ctx.fillRect(x-14, y+22, 28, 5);
  }

  // ===== VIEW AVATAR â€” BACK VIEW: NO HEAD, ONLY HAIR RECT =====
  function drawAgyBackView(vx, vy){
    const x = vx, y = vy;

    // hair only (rectangle blob). No face/head.
    vctx.fillStyle="#000";
    vctx.fillRect(x-18, y-60, 36, 60);

    // shirt
    vctx.fillStyle="#c1272d";
    vctx.fillRect(x-16, y-16, 32, 22);

    // sleeves
    vctx.fillRect(x-22, y-16, 6, 8);
    vctx.fillRect(x+16, y-16, 6, 8);

    // arms
    vctx.fillStyle="#f1c7a6";
    vctx.fillRect(x-22, y-8, 6, 10);
    vctx.fillRect(x+16, y-8, 6, 10);

    // pants + shoes
    vctx.fillStyle="#0e0e18";
    vctx.fillRect(x-16, y+6, 32, 16);

    vctx.fillStyle="#fff";
    vctx.fillRect(x-14, y+22, 28, 5);
  }

  // ===== GAME CONFIG =====
  const GOAL = 10;
  const LOG_W = 88;
  const LOG_H = 14;
  const LOG_GAP_Y = 66;

  const world = {
    running: true,
    state: "playing", // playing | falling | win
    landed: 0,
    slips: 0,
    currentIndex: 0,
    camY: 0,
    camTargetY: 0,
    shake: 0
  };

  const player = {
    x: canvas.width * 0.5,
    y: canvas.height - 70, // FEET baseline
    vy: 0,
    ridingLogIndex: -1 // if >=0: stick to that log's center
  };

  let logs = [];
  let birds = [];

  const rand = (a,b)=>a + Math.random()*(b-a);

  function setHUD(){
    logsCountEl.textContent = String(world.landed);
    slipsCountEl.textContent = String(world.slips);
  }

  function resetGame(){
    world.running = true;
    world.state = "playing";
    world.landed = 0;
    world.currentIndex = 0;
    world.camY = 0;
    world.camTargetY = 0;
    world.shake = 0;

    player.x = canvas.width * 0.5;
    player.y = canvas.height - 70;
    player.vy = 0;
    player.ridingLogIndex = -1;

    logs = [];
    const baseY = canvas.height - 140;
    for (let i=0;i<GOAL;i++){
      const y = baseY - i*LOG_GAP_Y;
      logs.push({
        x: rand(22, canvas.width - LOG_W - 22),
        y,
        w: LOG_W,
        h: LOG_H,
        dir: Math.random()>0.5 ? 1 : -1,
        sp: rand(0.9, 1.7) + i*0.03
      });
    }

    birds = Array.from({length: 4}, () => ({
      x: rand(20, canvas.width-20),
      y: rand(60, 160),
      baseY: 0,
      phase: Math.floor(Math.random()*3),
      t: 0,
      sp: rand(0.6, 1.0),
      drift: rand(0.06, 0.12)
    }));
    birds.forEach(b=>b.baseY=b.y);

    setHUD();
  }

  // ===== BGM: start on first interaction (iOS friendly) =====
  let bgmStarted = false;
  async function ensureBgm(){
    if (bgmStarted) return;
    bgmStarted = true;
    try{
      bgm.volume = 0.7;
      await bgm.play();
    }catch(e){
      // if it fails, we'll try again on next tap
      bgmStarted = false;
    }
  }

  // ===== INPUT =====
  function onTap(){
    ensureBgm();

    if (!world.running) return;
    if (world.state !== "playing") return;
    if (world.currentIndex >= GOAL) return;

    const target = logs[world.currentIndex];

    // Overlap test using avatar footprint width (hair width ~36, use 36-ish)
    const pxL = player.x - 18;
    const pxR = player.x + 18;
    const lxL = target.x;
    const lxR = target.x + target.w;

    const overlap = (pxR > lxL) && (pxL < lxR);

    if (overlap){
      // LAND: make shoe bottom align to log top EXACTLY
      // shoe bottom = player.y + 27
      // so player.y = logTop - 27
      player.y = target.y - SHOE_BOTTOM_OFFSET;

      // stick to this log so she moves with it
      player.ridingLogIndex = world.currentIndex;

      world.landed++;
      world.currentIndex++;
      setHUD();

      // camera follows upward
      const approxTop = player.y - 80;
      world.camTargetY = (canvas.height*0.58) - approxTop;

      if (world.landed >= GOAL){
        world.state = "win";
        world.running = false;
        setTimeout(() => {
          gamePage.classList.remove("active");
          viewPage.classList.add("active");
        }, 220);
      }
    } else {
      // MISS -> fall -> restart
      world.slips++;
      setHUD();
      world.state = "falling";
      world.shake = 10;
      player.vy = 6;
      player.ridingLogIndex = -1;
    }
  }

  canvas.addEventListener("pointerdown", (e)=>{
    e.preventDefault();
    onTap();
  }, {passive:false});

  // ===== GAME UPDATE =====
  function update(dt){
    // logs move
    for (let i=0;i<logs.length;i++){
      const log = logs[i];
      log.x += log.dir * log.sp;
      if (log.x <= 14){ log.x = 14; log.dir *= -1; }
      if (log.x + log.w >= canvas.width - 14){ log.x = canvas.width - 14 - log.w; log.dir *= -1; }
    }

    // if riding a log, follow its center x every frame
    if (player.ridingLogIndex >= 0){
      const idx = player.ridingLogIndex;
      // safety guard
      if (logs[idx]){
        player.x = logs[idx].x + logs[idx].w/2;
        // keep y locked too (log is horizontal, no y movement)
        player.y = logs[idx].y - SHOE_BOTTOM_OFFSET;
      }
    }

    // birds bob + drift
    for (const b of birds){
      b.t += dt * b.sp;
      if (b.t >= 18){
        b.t = 0;
        b.phase = (b.phase + 1) % 3;
      }
      const offsets = [-5, 0, 4];
      b.y = b.baseY + offsets[b.phase];
      b.x += b.drift * dt;
      if (b.x > canvas.width + 18) b.x = -18;
    }

    if (world.state === "falling"){
      player.y += player.vy;
      player.vy += 0.55;
      if (player.y > canvas.height + 90){
        resetGame();
      }
    }

    world.camY += (world.camTargetY - world.camY) * 0.08;
    if (world.shake > 0) world.shake -= 1;
  }

  // ===== GAME DRAW =====
  function drawDayForestBackground(){
    const g = ctx.createLinearGradient(0,0,0,canvas.height);
    g.addColorStop(0, "#c8f0ff");
    g.addColorStop(0.55, "#b7f1d1");
    g.addColorStop(1, "#75c79a");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle = "rgba(66, 156, 120, 0.22)";
    for (let i=0;i<9;i++){
      ctx.beginPath();
      ctx.ellipse(i*55 + 25, 140 + (i%2)*10, 52, 28, 0, 0, Math.PI*2);
      ctx.fill();
    }

    ctx.fillStyle = "rgba(32, 92, 76, 0.20)";
    for (let x=10; x<canvas.width; x+=48){
      ctx.fillRect(x, 120, 20, canvas.height-120);
    }

    ctx.fillStyle = "rgba(55, 155, 105, 0.34)";
    for (let i=0;i<10;i++){
      ctx.beginPath();
      ctx.ellipse(i*44 + 20, 270 + (i%2)*8, 48, 26, 0, 0, Math.PI*2);
      ctx.fill();
    }

    drawTree(38, 165, 95, 320);
    drawTree(canvas.width - 133, 160, 95, 330);

    ctx.fillStyle = "rgba(64, 112, 80, 0.46)";
    ctx.fillRect(0, canvas.height-54, canvas.width, 54);
  }

  function drawTree(x, y, w, h){
    ctx.fillStyle = "rgba(149, 101, 72, 0.95)";
    ctx.fillRect(x + w*0.35, y + 80, w*0.28, h - 80);
    ctx.fillRect(x + w*0.18, y + 125, w*0.22, 18);
    ctx.fillRect(x + w*0.58, y + 140, w*0.20, 18);

    ctx.fillStyle = "rgba(74, 168, 100, 0.95)";
    ctx.beginPath(); ctx.ellipse(x + w*0.5, y + 70, w*0.55, 46, 0, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.ellipse(x + w*0.30, y + 85, w*0.45, 40, 0, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.ellipse(x + w*0.70, y + 90, w*0.42, 38, 0, 0, Math.PI*2); ctx.fill();
  }

  function drawBird(b){
    ctx.fillStyle = "rgba(0,0,0,0.40)";
    const x = Math.round(b.x);
    const y = Math.round(b.y);
    ctx.fillRect(x, y, 2, 2);
    ctx.fillRect(x-4, y+2, 2, 2);
    ctx.fillRect(x+4, y+2, 2, 2);
  }

  function drawLog(log){
    ctx.fillStyle = "#a76636";
    ctx.fillRect(log.x, log.y, log.w, log.h);
    ctx.fillStyle = "rgba(0,0,0,0.22)";
    ctx.fillRect(log.x, log.y + log.h - 4, log.w, 4);
    ctx.fillStyle = "rgba(255,255,255,0.12)";
    ctx.fillRect(log.x + 10, log.y + 5, log.w - 20, 1);
    ctx.fillRect(log.x + 14, log.y + 9, log.w - 28, 1);
  }

  function draw(){
    const shakeX = world.shake > 0 ? (Math.random()*6 - 3) : 0;
    const shakeY = world.shake > 0 ? (Math.random()*6 - 3) : 0;

    ctx.save();
    ctx.translate(shakeX, shakeY);

    drawDayForestBackground();
    birds.forEach(drawBird);

    ctx.save();
    ctx.translate(0, world.camY);

    for (const log of logs) drawLog(log);

    if (world.currentIndex < GOAL){
      const t = logs[world.currentIndex];
      ctx.fillStyle = "rgba(255,255,255,0.18)";
      ctx.fillRect(t.x, t.y - 6, t.w, 3);
    }

    // gameplay avatar (feet baseline)
    drawAgyGameplay(player.x, player.y);

    ctx.restore();
    ctx.restore();
  }

  // ===== RAF LOOP =====
  let last = 0;
  function loop(ts){
    if (!last) last = ts;
    const dt = Math.min(33, ts - last);
    last = ts;

    if (world.running) update(dt);
    draw();
    requestAnimationFrame(loop);
  }

  // ===== VIEW SCENE (unchanged except back-view avatar) =====
  const view = {
    clouds: [
      { x: -160, y: 78,  s: 1.05, sp: 0.09 },
      { x:  40,  y: 118, s: 0.85, sp: 0.06 },
      { x:  240, y: 92,  s: 0.95, sp: 0.07 }
    ],
    petals: Array.from({length: 26}, () => ({
      x: rand(0, viewCanvas.width),
      y: rand(-30, viewCanvas.height),
      r: rand(4,7),
      sp: rand(0.06, 0.14),
      drift: rand(-0.05, 0.05),
      a: rand(0.10, 0.22)
    }))
  };

  function drawPrettyCloud(c, x, y, s){
    c.save();
    c.globalAlpha = 0.92;
    c.fillStyle = "#ffffff";
    c.beginPath();
    c.ellipse(x + 30*s, y + 18*s, 28*s, 16*s, 0, 0, Math.PI*2);
    c.ellipse(x + 55*s, y + 14*s, 34*s, 18*s, 0, 0, Math.PI*2);
    c.ellipse(x + 82*s, y + 18*s, 28*s, 16*s, 0, 0, Math.PI*2);
    c.ellipse(x + 55*s, y + 24*s, 60*s, 18*s, 0, 0, Math.PI*2);
    c.fill();
    c.restore();
  }

  function drawSunWithRays(c, cx, cy, r){
    c.save();
    c.strokeStyle = "rgba(255, 211, 90, 0.55)";
    c.lineWidth = 3;
    for (let i=0;i<12;i++){
      const a = (Math.PI*2) * (i/12);
      const x1 = cx + Math.cos(a) * (r + 8);
      const y1 = cy + Math.sin(a) * (r + 8);
      const x2 = cx + Math.cos(a) * (r + 22);
      const y2 = cy + Math.sin(a) * (r + 22);
      c.beginPath();
      c.moveTo(x1,y1);
      c.lineTo(x2,y2);
      c.stroke();
    }
    c.restore();

    c.fillStyle = "#ffd35a";
    c.beginPath();
    c.arc(cx, cy, r, 0, Math.PI*2);
    c.fill();
  }

  function drawBush(c, x, y, w, h, col){
    c.fillStyle = col;
    c.beginPath();
    c.ellipse(x + w*0.20, y + h*0.55, w*0.22, h*0.30, 0, 0, Math.PI*2);
    c.ellipse(x + w*0.45, y + h*0.40, w*0.28, h*0.36, 0, 0, Math.PI*2);
    c.ellipse(x + w*0.72, y + h*0.55, w*0.22, h*0.30, 0, 0, Math.PI*2);
    c.ellipse(x + w*0.48, y + h*0.65, w*0.40, h*0.26, 0, 0, Math.PI*2);
    c.fill();
  }

  function drawFlower(c, x, y){
    c.save();
    c.globalAlpha = 0.9;
    c.fillStyle = "#ff8fb0";
    c.beginPath(); c.arc(x, y, 5, 0, Math.PI*2); c.fill();
    c.fillStyle = "#ffd35a";
    c.beginPath(); c.arc(x, y, 2, 0, Math.PI*2); c.fill();
    c.restore();
  }

  function drawNameTag(c, text, x, y){
  c.save();
  c.textAlign = "center";
  c.font = "10px Arial";                 // not bold
  c.fillStyle = "#f5f5f5";               // soft white
  c.shadowColor = "rgba(0,0,0,0.6)";
  c.shadowBlur = 4;
  c.shadowOffsetX = 0;
  c.shadowOffsetY = 0;
  c.fillText(text, x, y);                // use provided args
  c.restore();
}


  let viewLast = 0;
  function viewLoop(ts){
    if (!viewLast) viewLast = ts;
    const dt = Math.min(33, ts - viewLast);
    viewLast = ts;

    if (!viewPage.classList.contains("active")){
      requestAnimationFrame(viewLoop);
      return;
    }

    const W = viewCanvas.width, H = viewCanvas.height;

    const g = vctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0, "#7fd6ff");
    g.addColorStop(0.55, "#dff6ff");
    g.addColorStop(1, "#7ddf9c");
    vctx.fillStyle = g;
    vctx.fillRect(0,0,W,H);

    drawSunWithRays(vctx, W-74, 78, 34);

    for (const cl of view.clouds){
      cl.x += cl.sp * dt * 1.8;
      if (cl.x > W + 190) cl.x = -220;
      drawPrettyCloud(vctx, cl.x, cl.y, cl.s);
    }

    for (const p of view.petals){
      p.y += p.sp * dt * 1.2;
      p.x += p.drift * dt * 1.2;
      if (p.y > H + 20){ p.y = -20; p.x = rand(0,W); }
      vctx.fillStyle = `rgba(255, 160, 180, ${p.a})`;
      vctx.beginPath();
      vctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      vctx.fill();
    }

    vctx.fillStyle = "#43c36a";
    vctx.fillRect(0, H-150, W, 150);
    vctx.fillStyle = "rgba(0,0,0,0.06)";
    vctx.fillRect(0, H-150, W, 4);

    drawBush(vctx, -20, H-210, 160, 90, "rgba(46, 160, 92, 0.92)");
    drawBush(vctx, W-140, H-210, 170, 90, "rgba(46, 160, 92, 0.92)");
    drawBush(vctx, -10, H-185, 140, 75, "rgba(40, 140, 82, 0.92)");
    drawBush(vctx, W-135, H-185, 150, 75, "rgba(40, 140, 82, 0.92)");

    for (let i=0;i<6;i++){
      drawFlower(vctx, 26 + i*18, H-40 - (i%2)*8);
      drawFlower(vctx, W-26 - i*18, H-42 - (i%2)*10);
    }

    const ax = W/2;
    const ay = H-78; // feet baseline
    drawNameTag(vctx, "agy96", ax, ay-80);
    drawAgyBackView(ax, ay);

    requestAnimationFrame(viewLoop);
  }


  nextBtn.addEventListener("click", ()=>{
  // After MacRitchie, next is Waterloo (index 2)
  localStorage.setItem("mapPromptIndex", "2");
  location.href = "./map.html";
});



  // ===== INIT =====
  resetGame();
  requestAnimationFrame(loop);
  requestAnimationFrame(viewLoop);

})();
</script>
</body>
</html>
