<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Waterloo Ballet Studio</title>
  <style>
    :root{
      --cardBg1: rgba(24, 10, 40, 0.82);
      --cardBg2: rgba(12, 6, 22, 0.74);
      --border: rgba(255,255,255,0.12);
      --text: #f4f1ff;
      --muted: rgba(244,241,255,0.72);
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1100px 620px at 50% 12%, rgba(255,170,220,0.10), transparent 62%),
                  radial-gradient(900px 560px at 50% 82%, rgba(140,255,220,0.08), transparent 62%),
                  linear-gradient(160deg,#061523,#070714);
      color: var(--text);
    }
    .wrap{
      min-height:100svh;
      display:flex;
      justify-content:center;
      padding: 10px 12px 14px;
    }
    .card{
      width:min(560px, 100%);
      border-radius: 24px;
      background: linear-gradient(180deg, var(--cardBg1), var(--cardBg2));
      border: 1px solid var(--border);
      box-shadow: 0 30px 80px rgba(0,0,0,0.55);
      overflow:hidden;
      position:relative;
    }
    .header{
      padding: 16px 16px 10px;
      text-align:center;
    }
    h1{
      margin: 0 0 6px;
      font-size: 32px;
      line-height: 1.08;
      font-weight: 900;
      letter-spacing: -0.02em;
      text-shadow: 0 2px 10px rgba(0,0,0,0.35);
    }
    .sub{
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .hud{
      display:flex;
      gap: 10px;
      justify-content: space-between;
      padding: 0 14px 10px;
    }
    .pill{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      border-radius: 999px;
      padding: 10px 10px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      font-weight: 800;
      letter-spacing: 0.2px;
      min-width: 0;
    }
    .pill small{
      color: var(--muted);
      font-weight: 700;
    }

    .stage{ padding: 8px 12px 12px; }
    .frame{
      border-radius: 20px;
      background: rgba(0,0,0,0.16);
      border: 1px solid rgba(255,255,255,0.10);
      padding: 10px;
      position:relative;
    }
    canvas{
      width:100%;
      height:auto;
      display:block;
      border-radius: 16px;
      background: #f6eefe;
      touch-action: manipulation;
    }

    /* Controls BELOW her (on the studio floor) */
    .controls{
      position:absolute;
      left:50%;
      bottom: 18px;
      transform: translateX(-50%);
      display:flex;
      gap: 14px;
      z-index: 5;
      pointer-events:auto;
    }
    .btn{
      width: 78px;
      height: 78px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.30);
      background: rgba(255,255,255,0.28);
      box-shadow: 0 14px 30px rgba(0,0,0,0.14);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 34px;
      font-weight: 900;
      color: rgba(25,20,40,0.70);
      user-select:none;
      cursor:pointer;
      backdrop-filter: blur(8px);
    }
    .btn:active{ transform: translateY(1px); }

    /* Win overlay */
    .overlay{
      position:absolute;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 10;
      background: rgba(0,0,0,0.30);
      backdrop-filter: blur(3px);
    }
    .overlay.show{ display:flex; }

    .modal{
      width: min(420px, 86%);
      border-radius: 22px;
      padding: 18px 18px 16px;
      border: 1px solid rgba(255,255,255,0.24);
      background: rgba(255,255,255,0.18);
      box-shadow: 0 24px 70px rgba(0,0,0,0.35);
      text-align:center;
    }
    .modal h2{
      margin: 0 0 8px;
      font-size: 18px;
      line-height: 1.25;
      font-weight: 900;
    }
    .modal p{
      margin: 0 0 14px;
      color: rgba(255,255,255,0.78);
      font-size: 13px;
    }
    .modal button{
      appearance:none;
      border:0;
      width: 100%;
      border-radius: 999px;
      padding: 14px 16px;
      font-weight: 900;
      letter-spacing: 0.2px;
      background: rgba(255,255,255,0.24);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.26);
      cursor:pointer;
    }
    .modal button:active{ transform: translateY(1px); }

    /* Cue pulse so repeated same-direction cues feel ‚Äúnew‚Äù */
    .cuePulse{
      animation: cuePulse 140ms ease-out 1;
    }
    @keyframes cuePulse{
      0%{ transform: scale(1); }
      60%{ transform: scale(1.08); }
      100%{ transform: scale(1); }
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="header">
      <h1>Welcome to the Waterloo ballet studio! ü©∞</h1>
      <p class="sub">Tap left, right, or up to balance your piqu√© pose.</p>
    </div>

    <div class="hud">
      <div class="pill"><span>üéØ</span><span>Clicks:&nbsp;<strong id="hitCount">0</strong>&nbsp;<small>/ 10</small></span></div>
      <div class="pill"><span>‚è≥</span><span>Timer:&nbsp;<strong id="timeLeft">1.6</strong><small>s</small></span></div>
    </div>

    <div class="stage">
      <div class="frame">
        <canvas id="game" width="390" height="520" aria-label="Waterloo ballet game"></canvas>

        <div class="controls" aria-label="controls">
          <div class="btn" id="leftBtn" role="button" aria-label="left">‚Äπ</div>
          <div class="btn" id="upBtn" role="button" aria-label="up">ÀÑ</div>
          <div class="btn" id="rightBtn" role="button" aria-label="right">‚Ä∫</div>
        </div>

        <div class="overlay" id="overlay">
          <div class="modal">
            <h2>Congratulations! You balanced with grace under pressure. üôÜ‚Äç‚ôÄÔ∏è</h2>
            <p>Ready for the next mission?</p>
            <button id="nextBtn">On to my next mission!</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<audio id="bgm" src="arcade.mp3" preload="auto" loop></audio>

<script>
(() => {
  // ===== DOM =====
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");
  ctx.imageSmoothingEnabled = true;

  const hitCountEl = document.getElementById("hitCount");
  const timeLeftEl = document.getElementById("timeLeft");

  const leftBtn  = document.getElementById("leftBtn");
  const upBtn    = document.getElementById("upBtn");
  const rightBtn = document.getElementById("rightBtn");

  const overlay = document.getElementById("overlay");
  const nextBtn = document.getElementById("nextBtn");

  const bgm = document.getElementById("bgm");

  // ===== BGM (starts on first user action; remembers across pages) =====
  let bgmStarted = false;
  async function ensureBgm(){
    if (bgmStarted) return;
    bgmStarted = true;
    try{
      bgm.volume = 0.7;
      await bgm.play();
      localStorage.setItem("bgmPlaying","true");
    }catch(e){
      bgmStarted = false;
    }
  }
  if (localStorage.getItem("bgmPlaying")==="true"){
    // try (may still be blocked until tap)
    ensureBgm();
  }

  // ===== GAME CONFIG =====
  const TARGET_HITS = 10;
  const WINDOW_MS = 1600; // 1.6s per cue (per your latest)
  const COLORS = ["#7ad6ff","#ff7ad6","#7affb0","#ffd37a","#b07aff","#7affff","#ff7a7a","#9cff7a"];

  // ===== STATE =====
  const state = {
    mode: "play", // play | fall | winAnim | winHold
    hits: 0,
    cue: "üëâ",       // emoji cue above head
    expected: "R",    // L | R | U
    cueStart: 0,
    now: 0,

    // dancer motion
    tilt: 0,          // current tilt (radians)
    tiltTarget: 0,    // target tilt
    jumpY: 0,
    jumpV: 0,

    // fall motion
    fallY: 0,
    fallV: 0,
    fallTilt: 0,

    // confetti
    confetti: [],
    confettiOn: false,
    winT0: 0,
    hopT0: 0,

    // cue pop
    cuePulseT: 0
  };

  function setHUD(){
    hitCountEl.textContent = String(state.hits);
  }

  function setCue(expected){
    // expected: "L" | "R" | "U"
    state.expected = expected;
    state.cue = expected === "L" ? "üëà" : expected === "R" ? "üëâ" : "üëÜ";
    state.cueStart = performance.now();

    // She tilts OPPOSITE the cue direction (as requested)
    // cue üëâ means user must press right, so she tilts LEFT (negative)
    if (expected === "R") state.tiltTarget = -0.38;
    if (expected === "L") state.tiltTarget =  0.38;
    if (expected === "U") state.tiltTarget =  0.00;

    // cue pulse (so repeated same direction feels ‚Äúnew‚Äù)
    state.cuePulseT = performance.now();
  }

  function randNextExpected(){
    // only L/R/U now (fair distribution)
    const r = Math.random();
    return r < 0.40 ? "L" : r < 0.80 ? "R" : "U";
  }

  function resetRun(){
    state.mode = "play";
    state.hits = 0;
    state.tilt = 0;
    state.tiltTarget = 0;
    state.jumpY = 0;
    state.jumpV = 0;
    state.fallY = 0;
    state.fallV = 0;
    state.fallTilt = 0;

    state.confetti = [];
    state.confettiOn = false;
    overlay.classList.remove("show");

    setHUD();
    setCue(randNextExpected());
  }

  function fail(){
    state.mode = "fall";
    state.fallY = 0;
    state.fallV = 3.6;
    state.fallTilt = state.tilt; // start from current tilt
  }

  function win(){
    state.mode = "winAnim";
    state.winT0 = performance.now();
    state.hopT0 = performance.now();
    state.tiltTarget = 0;
    state.confettiOn = true;
    state.confetti = spawnConfetti(220);

    // lock cue so it doesn‚Äôt distract
    state.cue = "";
  }

  // ===== INPUT =====
  function handleInput(input){ // "L" | "R" | "U"
    ensureBgm();

    if (state.mode !== "play") return;

    const t = performance.now();
    const elapsed = t - state.cueStart;

    if (elapsed > WINDOW_MS){
      fail();
      return;
    }

    if (input !== state.expected){
      fail();
      return;
    }

    // correct
    state.hits++;
    setHUD();

    // snap back upright quickly
    state.tiltTarget = 0;

    // jump if UP correct
    if (input === "U"){
      state.jumpV = -6.8; // quick hop
    }

    if (state.hits >= TARGET_HITS){
      win();
      return;
    }

    // next cue
    setCue(randNextExpected());
  }

  leftBtn.addEventListener("pointerdown", (e)=>{ e.preventDefault(); handleInput("L"); }, {passive:false});
  rightBtn.addEventListener("pointerdown",(e)=>{ e.preventDefault(); handleInput("R"); }, {passive:false});
  upBtn.addEventListener("pointerdown",   (e)=>{ e.preventDefault(); handleInput("U"); }, {passive:false});

  // ===== DRAW HELPERS =====
  function roundedRect(c,x,y,w,h,r){
    const rr = Math.min(r, w/2, h/2);
    c.beginPath();
    c.moveTo(x+rr, y);
    c.arcTo(x+w, y, x+w, y+h, rr);
    c.arcTo(x+w, y+h, x, y+h, rr);
    c.arcTo(x, y+h, x, y, rr);
    c.arcTo(x, y, x+w, y, rr);
    c.closePath();
  }

  function drawStudioBackground(){
    const W = canvas.width, H = canvas.height;

    // soft lilac gradient
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0, "#f7eefe");
    g.addColorStop(0.55, "#f4dff0");
    g.addColorStop(1, "#f7d8c6");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    // mirror wall panels
    ctx.save();
    ctx.globalAlpha = 0.55;
    ctx.fillStyle = "rgba(255,255,255,0.55)";
    roundedRect(ctx, 28, 40, W-56, 240, 18);
    ctx.fill();
    ctx.globalAlpha = 0.20;
    ctx.strokeStyle = "rgba(180,120,160,0.35)";
    ctx.lineWidth = 2;
    roundedRect(ctx, 28, 40, W-56, 240, 18);
    ctx.stroke();

    // mirror vertical seams
    ctx.globalAlpha = 0.18;
    ctx.strokeStyle = "rgba(120,90,120,0.35)";
    ctx.lineWidth = 2;
    for (let i=1;i<=4;i++){
      const x = 28 + (W-56) * (i/5);
      ctx.beginPath();
      ctx.moveTo(x, 56);
      ctx.lineTo(x, 268);
      ctx.stroke();
    }

    // ceiling lights
    ctx.globalAlpha = 0.20;
    ctx.fillStyle = "rgba(210,240,255,0.9)";
    for (let i=0;i<4;i++){
      roundedRect(ctx, 58 + i*(W-116)/3, 62, 64, 16, 9);
      ctx.fill();
    }
    ctx.restore();

    // barre
    ctx.save();
    ctx.globalAlpha = 0.85;
    ctx.fillStyle = "rgba(135,110,120,0.65)";
    ctx.fillRect(36, 320, W-72, 10);
    ctx.globalAlpha = 0.45;
    ctx.fillStyle = "rgba(90,80,95,0.55)";
    for (let i=0;i<6;i++){
      ctx.fillRect(46 + i*(W-92)/5, 330, 8, 52);
    }
    ctx.restore();

    // floor boards
    const floorY = 360;
    const fg = ctx.createLinearGradient(0,floorY,0,H);
    fg.addColorStop(0, "#f2cfae");
    fg.addColorStop(1, "#e8b184");
    ctx.fillStyle = fg;
    ctx.fillRect(0,floorY,W,H-floorY);

    ctx.save();
    ctx.globalAlpha = 0.22;
    ctx.strokeStyle = "rgba(120,80,60,0.55)";
    ctx.lineWidth = 1;
    for (let x=22; x<W; x+=28){
      ctx.beginPath();
      ctx.moveTo(x, floorY);
      ctx.lineTo(x, H);
      ctx.stroke();
    }
    ctx.restore();

    // spotlight ellipse (soft)
    ctx.save();
    ctx.globalAlpha = 0.22;
    ctx.fillStyle = "rgba(255,255,255,0.9)";
    ctx.beginPath();
    ctx.ellipse(W/2, 290, 210, 260, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();
  }

  function drawNameTag(x, y){
    ctx.save();
    ctx.textAlign = "center";
    ctx.font = "12px Arial";
    ctx.fillStyle = "rgba(255,255,255,0.92)";
    ctx.shadowColor = "rgba(0,0,0,0.55)";
    ctx.shadowBlur = 4;
    ctx.fillText("agy96", x, y);
    ctx.restore();
  }

  function drawCueBubble(x, y){
    if (!state.cue) return;

    const pulse = (performance.now() - state.cuePulseT) < 170;
    ctx.save();
    if (pulse) ctx.scale(1.0, 1.0);

    const w = 160, h = 62;
    const bx = x - w/2;
    const by = y - h/2;

    ctx.globalAlpha = 0.92;
    ctx.fillStyle = "rgba(255,255,255,0.78)";
    ctx.strokeStyle = "rgba(255,120,190,0.60)";
    ctx.lineWidth = 3;
    roundedRect(ctx, bx, by, w, h, 18);
    ctx.fill();
    roundedRect(ctx, bx, by, w, h, 18);
    ctx.stroke();

    // emoji cue
    ctx.globalAlpha = 1;
    ctx.textAlign = "center";
    ctx.font = "28px Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji, sans-serif";
    // tiny ‚Äúpulse‚Äù feel
    if (pulse){
      ctx.save();
      ctx.translate(x, y);
      ctx.scale(1.06, 1.06);
      ctx.translate(-x, -y);
      ctx.fillText(state.cue, x, y+10);
      ctx.restore();
    }else{
      ctx.fillText(state.cue, x, y+10);
    }

    ctx.restore();
  }

  // Ballet avatar (canvas) ‚Äî keep your clean ‚Äúimage 2‚Äù proportions,
  // with better arms (rounded above) + legs anchored from tutu area.
  function drawBallerina(cx, cy, tiltRad, extraY){
    // cy = feet baseline on floor
    const y = cy + extraY;

    ctx.save();
    ctx.translate(cx, y);
    ctx.rotate(tiltRad);

    // shadow
    ctx.save();
    ctx.rotate(-tiltRad);
    ctx.globalAlpha = 0.22;
    ctx.fillStyle = "rgba(0,0,0,0.55)";
    ctx.beginPath();
    ctx.ellipse(0, 18, 72, 18, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();

    // torso anchor
    const headTop = -150;
    const hairW = 44, hairH = 88;
    const faceW = 28, faceH = 34;

    // hair
    ctx.fillStyle = "#000";
    roundedRect(ctx, -hairW/2, headTop, hairW, hairH, 10);
    ctx.fill();

    // face (same face block)
    ctx.fillStyle = "#f1c7a6";
    ctx.fillRect(-faceW/2, headTop+26, faceW, faceH);

    // glasses (same vibe)
    ctx.fillStyle = "#000";
    // left lens
    ctx.fillRect(-16, headTop+38, 14, 10);
    ctx.fillRect(-18, headTop+36, 18, 2);
    ctx.fillRect(-18, headTop+46, 18, 2);
    ctx.fillRect(-18, headTop+36, 2, 12);
    ctx.fillRect(-2,  headTop+36, 2, 12);
    // right lens
    ctx.fillRect(2, headTop+38, 14, 10);
    ctx.fillRect(0, headTop+36, 18, 2);
    ctx.fillRect(0, headTop+46, 18, 2);
    ctx.fillRect(0, headTop+36, 2, 12);
    ctx.fillRect(16, headTop+36, 2, 12);
    // bridge
    ctx.fillRect(-2, headTop+41, 4, 2);

    // top (sleeveless light blue)
    ctx.fillStyle = "#97c9ff";
    ctx.fillRect(-22, headTop+78, 44, 46);

    // arms ‚Äî rounded ABOVE (canvas arcs), not ‚Äúwrong curls‚Äù
    ctx.save();
    ctx.lineWidth = 9;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#f1c7a6";
    // left arm arc
    ctx.beginPath();
    ctx.arc(-16, headTop+92, 28, Math.PI*1.05, Math.PI*1.70);
    ctx.stroke();
    // right arm arc
    ctx.beginPath();
    ctx.arc(16, headTop+92, 28, Math.PI*1.30, Math.PI*1.95);
    ctx.stroke();
    ctx.restore();

    // tutu skirt (pink)
    ctx.fillStyle = "#ff7ab8";
    ctx.fillRect(-28, headTop+120, 56, 18);
    ctx.globalAlpha = 0.18;
    ctx.fillStyle = "rgba(255,255,255,0.9)";
    ctx.fillRect(-24, headTop+124, 48, 2);
    ctx.globalAlpha = 1;

    // LEGS:
    // Standing left leg straight down (pointe)
    // Bent leg: horizontal thigh from tutu area, then shin angled back toward standing leg.
    const hipY = headTop + 138;
    ctx.strokeStyle = "#f1c7a6";
    ctx.lineWidth = 12;
    ctx.lineCap = "round";

    // standing leg (left-ish)
    ctx.beginPath();
    ctx.moveTo(-6, hipY);
    ctx.lineTo(-10, hipY + 64);
    ctx.stroke();

    // standing shoe
    ctx.fillStyle = "#fff";
    ctx.fillRect(-20, hipY + 64, 20, 8);

    // bent leg: thigh starts near tutu (NOT from standing knee)
    // thigh horizontal out to right
    const thighStartX = 6, thighStartY = hipY + 12;
    const kneeX = 34, kneeY = hipY + 18;

    ctx.beginPath();
    ctx.moveTo(thighStartX, thighStartY);
    ctx.lineTo(kneeX, kneeY);
    ctx.stroke();

    // shin leans back toward standing leg (diagonal /)
    const ankleX = 16, ankleY = hipY + 56;
    ctx.beginPath();
    ctx.moveTo(kneeX, kneeY);
    ctx.lineTo(ankleX, ankleY);
    ctx.stroke();

    // bent shoe
    ctx.fillStyle = "#fff";
    ctx.fillRect(8, ankleY, 20, 8);

    ctx.restore();
  }

  function spawnConfetti(n){
    const W = canvas.width, H = canvas.height;
    const arr = [];
    for (let i=0;i<n;i++){
      arr.push({
        x: Math.random()*W,
        y: -Math.random()*H*0.9,
        w: 6 + Math.random()*10,
        h: 6 + Math.random()*12,
        vx: -0.5 + Math.random()*1.0,
        vy: 1.8 + Math.random()*4.2,
        rot: Math.random()*Math.PI,
        vr: (-0.14 + Math.random()*0.28),
        col: COLORS[(Math.random()*COLORS.length)|0],
        a: 0.85
      });
    }
    return arr;
  }

  function drawConfetti(dt){
    if (!state.confettiOn) return;
    const W = canvas.width, H = canvas.height;

    for (const p of state.confetti){
      p.x += p.vx * dt;
      p.y += p.vy * dt;
      p.rot += p.vr * dt;

      if (p.y > H + 30){
        // loop down a bit to keep it chaotic for the 2s
        p.y = -20 - Math.random()*60;
        p.x = Math.random()*W;
      }

      ctx.save();
      ctx.globalAlpha = p.a;
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.col;
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();
    }
  }

  // ===== LOOP =====
  let last = 0;
  function loop(ts){
    if (!last) last = ts;
    const dt = Math.min(33, ts - last);
    last = ts;
    state.now = ts;

    // timer display
    if (state.mode === "play"){
      const left = Math.max(0, (WINDOW_MS - (ts - state.cueStart)) / 1000);
      timeLeftEl.textContent = left.toFixed(1);
      if (ts - state.cueStart > WINDOW_MS){
        fail();
      }
    } else {
      timeLeftEl.textContent = "‚Äî";
    }

    // update dancer motion
    // ease tilt
    state.tilt += (state.tiltTarget - state.tilt) * 0.16;

    // jump physics (for UP correct)
    state.jumpY += state.jumpV;
    state.jumpV += 0.6;
    if (state.jumpY > 0){ state.jumpY = 0; state.jumpV = 0; }

    // falling
    if (state.mode === "fall"){
      state.fallY += state.fallV;
      state.fallV += 0.9;
      // tilt more dramatically while falling
      state.fallTilt += (state.tiltTarget >= 0 ? 0.06 : -0.06);

      if (state.fallY > 220){
        resetRun(); // immediate restart
      }
    }

    // win animation timing
    if (state.mode === "winAnim"){
      const t = ts - state.winT0;

      // hop 3 times (keep scene visible)
      // 3 hops over ~900ms
      const hopT = Math.min(900, ts - state.hopT0);
      const phase = hopT / 900;
      const hops = 3;
      const hopY = -18 * Math.max(0, Math.sin(Math.PI * hops * phase));

      // store as jumpY override
      state.jumpY = hopY;

      // after 2s, show button
      if (t > 2000){
        state.mode = "winHold";
        overlay.classList.add("show");
      }
    }

    // ===== DRAW =====
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawStudioBackground();

    // cue bubble near top
    drawCueBubble(canvas.width/2, 108);

    // place agy on FLOOR (right above the bottom buttons)
    // floor baseline is around y=468-ish inside canvas due to boards
    const dancerCX = canvas.width/2;
    const dancerFeetY = 438; // puts her on floor, above controls

    // name tag above head
    drawNameTag(dancerCX, 188);

    if (state.mode === "fall"){
      // obvious fall: drop straight down with extra tilt
      drawBallerina(dancerCX, dancerFeetY + state.fallY, state.fallTilt, 0);
    } else {
      drawBallerina(dancerCX, dancerFeetY, state.tilt, state.jumpY);
    }

    // confetti on top, but DO NOT hide the scene
    if (state.confettiOn){
      drawConfetti(dt);
    }

    requestAnimationFrame(loop);
  }

  // ===== WIN BUTTON: go back to map with stadium prompt =====
  nextBtn.addEventListener("click", ()=>{
    // stadium prompt index in your map prompt list is 3 (0-based)
    localStorage.setItem("mapPromptIndex", "3");
    location.href = "./map.html";
  });

  // ===== INIT =====
  resetRun();
  requestAnimationFrame(loop);

})();
</script>
</body>
</html>
