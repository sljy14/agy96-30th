<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Waterloo Ballet Studio</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:linear-gradient(180deg,#f6eaff,#e7d9ff);
  overflow:hidden;
  color:#fff;
}

.wrap{
  height:100svh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding:14px;
  box-sizing:border-box;
}

h1{
  margin:8px 0 4px;
  font-weight:1000;
  font-size:26px;
  text-align:center;
}

.sub{
  font-size:14px;
  opacity:0.9;
  margin-bottom:10px;
  text-align:center;
}

.stage{
  position:relative;
  width:100%;
  max-width:420px;
  aspect-ratio: 1 / 1.25;
  border-radius:18px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,0.3);
  background:
    linear-gradient(#fff 0 60%, #f8d9ff 60% 100%);
}

/* wooden floor */
.floor{
  position:absolute;
  bottom:0;
  width:100%;
  height:35%;
  background:linear-gradient(180deg,#f4c68b,#e8ad68);
}

/* balance bar */
.meter{
  position:absolute;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  width:70%;
  height:8px;
  background:rgba(0,0,0,0.2);
  border-radius:999px;
}
.indicator{
  position:absolute;
  top:-4px;
  width:16px;
  height:16px;
  border-radius:50%;
  background:#ff5fa2;
  left:50%;
  transform:translateX(-50%);
}

/* arrows */
.arrow{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  font-size:46px;
  font-weight:1000;
  background:rgba(255,255,255,0.2);
  border-radius:50%;
  width:70px;
  height:70px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  user-select:none;
}
.left{ left:10px; }
.right{ right:10px; }

/* avatar */
.avatar{
  position:absolute;
  bottom:36%;
  left:50%;
  transform:translateX(-50%);
  width:90px;
  height:150px;
}

.hair{
  position:absolute;
  width:60px;height:90px;
  background:#000;
  left:50%;transform:translateX(-50%);
  top:0;border-radius:8px;
}
.face{
  position:absolute;
  width:40px;height:48px;
  background:#f1c7a6;
  left:50%;transform:translateX(-50%);
  top:22px;
}
.glasses{
  position:absolute;
  top:42px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
}
.glasses div{
  width:14px;height:12px;
  border:3px solid #000;
  margin:0 4px;
}
.bridge{
  position:absolute;
  top:6px;
  left:50%;
  width:8px;height:3px;
  background:#000;
  transform:translateX(-50%);
}

.top{
  position:absolute;
  top:80px;
  left:50%;
  transform:translateX(-50%);
  width:50px;height:28px;
  background:#8ecaff;
}
.tutu{
  position:absolute;
  top:100px;
  left:50%;
  transform:translateX(-50%);
  width:70px;height:20px;
  background:#ff9ccf;
}
.leg-main{
  position:absolute;
  top:120px;
  left:50%;
  transform:translateX(-50%);
  width:10px;height:36px;
  background:#f1c7a6;
}
.leg-back{
  position:absolute;
  top:130px;
  left:65%;
  width:8px;height:28px;
  background:#f1c7a6;
  transform:rotate(20deg);
}

/* popup */
.popup{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.6);
  display:none;
  align-items:center;
  justify-content:center;
}
.box{
  background:#fff;
  color:#333;
  padding:20px;
  border-radius:16px;
  text-align:center;
  max-width:280px;
}
.box button{
  margin-top:12px;
  padding:12px 18px;
  border:none;
  border-radius:999px;
  background:#ff5fa2;
  color:#fff;
  font-weight:900;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="wrap">
<h1>Welcome to the Waterloo ballet studio! ü©∞</h1>
<div class="sub">Tap left or right to balance your piqu√© pose.</div>

<div class="stage" id="stage">
  <div class="floor"></div>

  <div class="arrow left" id="leftBtn">‚¨ÖÔ∏è</div>
  <div class="arrow right" id="rightBtn">‚û°Ô∏è</div>

  <div class="avatar" id="avatar">
    <div class="hair"></div>
    <div class="face"></div>
    <div class="glasses">
      <div></div><div></div>
    </div>
    <div class="bridge"></div>
    <div class="top"></div>
    <div class="tutu"></div>
    <div class="leg-main"></div>
    <div class="leg-back"></div>
  </div>

  <div class="meter">
    <div class="indicator" id="indicator"></div>
  </div>

  <div class="popup" id="popup">
    <div class="box">
      <div>Congratulations! You balanced with grace under pressure.</div>
      <button id="nextBtn">On to my next mission!</button>
    </div>
  </div>

</div>
</div>

<audio id="bgm" src="./arcade.mp3" loop></audio>

<script>
const bgm=document.getElementById("bgm");
bgm.volume=0.5;
bgm.play().catch(()=>{});

let balance=0;
let speed=0.002;
let startTime=Date.now();
let alive=true;

const indicator=document.getElementById("indicator");
const avatar=document.getElementById("avatar");
const popup=document.getElementById("popup");

function update(){
  if(!alive)return;

  balance += (Math.random()>0.5?1:-1)*speed*100;

  indicator.style.left = `calc(50% + ${balance}px)`;
  avatar.style.transform = `translateX(calc(-50% + ${balance}px)) rotate(${balance/6}deg)`;

  speed+=0.00005;

  if(Math.abs(balance)>90){
    fall();
  }

  if((Date.now()-startTime)/1000>=10){
    win();
  }

  requestAnimationFrame(update);
}

function fall(){
  alive=false;
  avatar.style.transition="transform 0.3s";
  avatar.style.transform+=" rotate(40deg)";
  setTimeout(()=>location.reload(),700);
}

function win(){
  alive=false;
  popup.style.display="flex";
  confetti();
}

document.getElementById("leftBtn").onclick=()=>balance-=15;
document.getElementById("rightBtn").onclick=()=>balance+=15;

document.getElementById("nextBtn").onclick=()=>{
  localStorage.setItem("mapPromptIndex","3");
  location.href="./map.html";
};

update();

/* üí• CHAOTIC CONFETTI */
function confetti(){
  for(let i=0;i<200;i++){
    const div=document.createElement("div");
    div.style.position="fixed";
    div.style.width="8px";
    div.style.height="8px";
    div.style.background=`hsl(${Math.random()*360},100%,60%)`;
    div.style.left=Math.random()*100+"vw";
    div.style.top="-10px";
    div.style.zIndex="999";
    document.body.appendChild(div);

    const fall=Math.random()*2000+2000;
    div.animate([
      {transform:"translateY(0) rotate(0deg)"},
      {transform:`translateY(100vh) rotate(${Math.random()*720}deg)`}
    ],{
      duration:fall,
      easing:"linear"
    });

    setTimeout(()=>div.remove(),fall);
  }
}
</script>
</body>
</html>
