<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Happy Birthday</title>
  <link rel="stylesheet" href="./css/style.css">
  <style>
    .wrap{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:24px;text-align:center}
    .msg{max-width:560px}
    .big2{font-size:24px;font-weight:1000}
    .soft{opacity:0.92;line-height:1.45;margin-top:10px}
  </style>
</head>
<body>
<div id="wrap">
  <div class="bg"></div>
  <div class="wrap">
    <div class="card msg">
      <div class="big2">Happy Birthday ğŸ¥³âœ¨</div>
      <div class="soft" id="out"></div>

      <div class="btnRow">
        <button id="openSurpriseBtn">Open mini surprise ğŸ</button>
        <button onclick="location.href='./map.html'">Back to map</button>
        <button onclick="location.href='./index.html'">Home</button>
      </div>
      <div class="hint">We can revise the wording + add audio later.</div>
    </div>
  </div>
</div>

  <!-- BGM -->
<audio id="bgm" src="./loop.mp3" preload="auto" loop></audio>

<script>
  const s = (() => {
    try {
      return JSON.parse(localStorage.getItem("bday_pixel_v1") || "{}");
    } catch {
      return {};
    }
  })();
  // ===== BGM CONTROL =====
const bgm = document.getElementById("bgm");

function safePlay(){
  bgm.play().catch(()=>{});
}

function switchBgmTo(src, shouldLoop=true){
  bgm.pause();
  bgm.currentTime = 0;
  bgm.src = src;
  bgm.loop = shouldLoop;
  bgm.load();
  safePlay();
}

// Start loop.mp3 after first user interaction (iOS autoplay rule)
document.addEventListener("pointerdown", function firstTap(){
  safePlay();
  document.removeEventListener("pointerdown", firstTap);
}, { once:true });

  const a1 = s.answers?.a1 || "";
  const a2 = s.answers?.a2 || "";

  const out = document.getElementById("out");
  out.innerHTML = `
    You deserve the best â€” always.<br/><br/>
    <b>What you wrote:</b><br/>
    <div style="text-align:left;margin-top:10px;opacity:0.95">
      <div>ğŸ«¶ 21-year-old you:</div>
      <div style="white-space:pre-wrap;opacity:0.9;margin:6px 0 12px">${escapeHtml(a1) || "<i>(empty)</i>"}</div>
      <div>âœ¨ 30-year-old you:</div>
      <div style="white-space:pre-wrap;opacity:0.9;margin-top:6px">${escapeHtml(a2) || "<i>(empty)</i>"}</div>
    </div>
    <br/>
    <b>From me:</b> Iâ€™m proud of you. And Iâ€™m rooting for you â€” loudly. ğŸ’–
  `;

  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
  }

const openSurpriseBtn = document.getElementById("openSurpriseBtn");
openSurpriseBtn.addEventListener("click", () => {
  switchBgmTo("./bday.mp3", true);
});

</script>
</body>
</html>
